import{jsx,jsxs}from"react/jsx-runtime";import{createContext,memo,useCallback,useEffect,useContext,useState,useMemo,useRef,useImperativeHandle,createElement,useLayoutEffect,forwardRef}from"react";import{Platform,Text,StyleSheet,View,Pressable,Appearance,useWindowDimensions,AppState}from"react-native";import{toDate as toDate$1}from"date-fns/toDate";import{differenceInMinutes}from"date-fns/differenceInMinutes";import{startOfDay}from"date-fns/startOfDay";import{addMinutes}from"date-fns/addMinutes";import{endOfDay}from"date-fns/endOfDay";import{subMinutes}from"date-fns/subMinutes";import{isAfter}from"date-fns/isAfter";import{isBefore}from"date-fns/isBefore";import{addDays}from"date-fns/addDays";import{getDay}from"date-fns/getDay";import{startOfWeek}from"date-fns/startOfWeek";import{differenceInDays}from"date-fns/differenceInDays";import{isSameDay}from"date-fns/isSameDay";import{differenceInCalendarDays}from"date-fns/differenceInCalendarDays";import{set}from"date-fns/set";import"date-fns/addHours";import"date-fns/setSeconds";import"date-fns/setHours";import"date-fns/setMinutes";import{areIntervalsOverlapping}from"date-fns/areIntervalsOverlapping";import{format}from"date-fns/format";import{eachDayOfInterval}from"date-fns/eachDayOfInterval";import Animated,{useSharedValue,useAnimatedStyle,interpolate,interpolateColor,withRepeat,withTiming,FadeOut,FadeIn,useDerivedValue,withSpring,runOnJS,cancelAnimation,useAnimatedReaction}from"react-native-reanimated";import{Gesture,GestureHandlerRootView,GestureDetector,ScrollView,RefreshControl}from"react-native-gesture-handler";import{isEqual}from"date-fns/isEqual";const isWeb="web"===Platform.OS;Platform.OS,Platform.OS;function isObject(value){return"object"==typeof value&&null!==value}function objectsEqual(a,b){if(a===b)return!0;if(a instanceof Date&&b instanceof Date)return a.getTime()===b.getTime();if(!isObject(a)||!isObject(b))return!1;const keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length!==keysB.length)return!1;for(const key of keysA){if(!Object.prototype.hasOwnProperty.call(b,key))return!1;if(!objectsEqual(a[key],b[key]))return!1}return!0}function arraysOfObjectsEqual(arrA,arrB){if(!Array.isArray(arrA)||!Array.isArray(arrB))return!1;if(arrA.length!==arrB.length)return!1;for(let i=0;i<arrA.length;i++)if(!objectsEqual(arrA[i],arrB[i]))return!1;return!0}new class{constructor(){try{this.expoHaptic=require("expo-haptics")}catch(_a){}try{this.reactNativeHaptic=require("react-native-haptic-feedback")}catch(_b){}}showInstallationWarning(){console.log("%c Warning: Haptic feedback library not found. Kindly install one of the following packages: expo-haptics, react-native-haptic-feedback.","color: orange")}isInstalled(){return this.expoHaptic||this.reactNativeHaptic}impactLight(){var _a,_b,_c,_d;this.expoHaptic?null===(_b=(_a=this.expoHaptic).impactAsync)||void 0===_b||_b.call(_a,"light"):this.reactNativeHaptic&&(null===(_d=(_c=this.reactNativeHaptic).trigger)||void 0===_d||_d.call(_c,"impactLight",{enableVibrateFallback:!0}))}};const RRule$=new class{showInstallationWarning(){console.log("%c Warning: RRule not found. Install rrule to support recurring events.","color: orange")}isInstalled(){return!!this.rrule}fromString(props){if(!this.rrule)return[];const rruleSet=this.rrule.rrulestr(props.rule,{dtstart:-1===props.rule.indexOf("DTSTART")?props.startDate:void 0});return props.between?rruleSet.between(props.between.start,props.between.end,!0):rruleSet.all()}constructor(){try{this.rrule=require("rrule")}catch(e){}}};function tzTokenizeDate(date,timeZone){const dtf=function(timeZone){dtfCache[timeZone]||(dtfCache[timeZone]=hourCycleSupported?new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:timeZone,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:timeZone,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}));return dtfCache[timeZone]}(timeZone);return"formatToParts"in dtf?function(dtf,date){try{const formatted=dtf.formatToParts(date),filled=[];for(let i=0;i<formatted.length;i++){const pos=typeToPos[formatted[i].type];void 0!==pos&&(filled[pos]=parseInt(formatted[i].value,10))}return filled}catch(error){if(error instanceof RangeError)return[NaN];throw error}}(dtf,date):function(dtf,date){const formatted=dtf.format(date),parsed=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(formatted);return[parseInt(parsed[3],10),parseInt(parsed[1],10),parseInt(parsed[2],10),parseInt(parsed[4],10),parseInt(parsed[5],10),parseInt(parsed[6],10)]}(dtf,date)}const typeToPos={year:0,month:1,day:2,hour:3,minute:4,second:5};const dtfCache={},testDateFormatted=new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),hourCycleSupported="06/25/2014, 00:00:00"===testDateFormatted||"‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00"===testDateFormatted;function newDateUTC(fullYear,month,day,hour,minute,second,millisecond){const utcDate=new Date(0);return utcDate.setUTCFullYear(fullYear,month,day),utcDate.setUTCHours(hour,minute,second,millisecond),utcDate}const patterns$1={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-])(\d{2}):?(\d{2})$/};function tzParseTimezone(timezoneString,date,isUtcDate){if(!timezoneString)return 0;let hours,absoluteOffset,token=patterns$1.timezoneZ.exec(timezoneString);if(token)return 0;if(token=patterns$1.timezoneHH.exec(timezoneString),token)return hours=parseInt(token[1],10),validateTimezone(hours)?-36e5*hours:NaN;if(token=patterns$1.timezoneHHMM.exec(timezoneString),token){hours=parseInt(token[2],10);const minutes=parseInt(token[3],10);return validateTimezone(hours,minutes)?(absoluteOffset=36e5*Math.abs(hours)+6e4*minutes,"+"===token[1]?-absoluteOffset:absoluteOffset):NaN}if(function(timeZoneString){if(validIANATimezoneCache[timeZoneString])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:timeZoneString}),validIANATimezoneCache[timeZoneString]=!0,!0}catch(error){return!1}}(timezoneString)){date=new Date(date||Date.now());const utcDate=isUtcDate?date:function(date){return newDateUTC(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes(),date.getSeconds(),date.getMilliseconds())}(date),offset=calcOffset(utcDate,timezoneString),fixedOffset=isUtcDate?offset:function(date,offset,timezoneString){const localTS=date.getTime();let utcGuess=localTS-offset;const o2=calcOffset(new Date(utcGuess),timezoneString);if(offset===o2)return offset;utcGuess-=o2-offset;const o3=calcOffset(new Date(utcGuess),timezoneString);if(o2===o3)return o2;return Math.max(o2,o3)}(date,offset,timezoneString);return-fixedOffset}return NaN}function calcOffset(date,timezoneString){const tokens=tzTokenizeDate(date,timezoneString),asUTC=newDateUTC(tokens[0],tokens[1]-1,tokens[2],tokens[3]%24,tokens[4],tokens[5],0).getTime();let asTS=date.getTime();const over=asTS%1e3;return asTS-=over>=0?over:1e3+over,asUTC-asTS}function validateTimezone(hours,minutes){return-23<=hours&&hours<=23&&(null==minutes||0<=minutes&&minutes<=59)}const validIANATimezoneCache={};function getTimezoneOffsetInMilliseconds(date){const utcDate=new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes(),date.getSeconds(),date.getMilliseconds()));return utcDate.setUTCFullYear(date.getFullYear()),+date-+utcDate}const tzPattern=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,patterns={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:tzPattern};function toDate(argument,options={}){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(null===argument)return new Date(NaN);const additionalDigits=null==options.additionalDigits?2:Number(options.additionalDigits);if(2!==additionalDigits&&1!==additionalDigits&&0!==additionalDigits)throw new RangeError("additionalDigits must be 0, 1 or 2");if(argument instanceof Date||"object"==typeof argument&&"[object Date]"===Object.prototype.toString.call(argument))return new Date(argument.getTime());if("number"==typeof argument||"[object Number]"===Object.prototype.toString.call(argument))return new Date(argument);if("[object String]"!==Object.prototype.toString.call(argument))return new Date(NaN);const dateStrings=function(dateString){const dateStrings={};let timeString,parts=patterns.dateTimePattern.exec(dateString);parts?(dateStrings.date=parts[1],timeString=parts[3]):(parts=patterns.datePattern.exec(dateString),parts?(dateStrings.date=parts[1],timeString=parts[2]):(dateStrings.date=null,timeString=dateString));if(timeString){const token=patterns.timeZone.exec(timeString);token?(dateStrings.time=timeString.replace(token[1],""),dateStrings.timeZone=token[1].trim()):dateStrings.time=timeString}return dateStrings}(argument),{year:year,restDateString:restDateString}=function(dateString,additionalDigits){if(dateString){const patternYYY=patterns.YYY[additionalDigits],patternYYYYY=patterns.YYYYY[additionalDigits];let token=patterns.YYYY.exec(dateString)||patternYYYYY.exec(dateString);if(token){const yearString=token[1];return{year:parseInt(yearString,10),restDateString:dateString.slice(yearString.length)}}if(token=patterns.YY.exec(dateString)||patternYYY.exec(dateString),token){const centuryString=token[1];return{year:100*parseInt(centuryString,10),restDateString:dateString.slice(centuryString.length)}}}return{year:null}}(dateStrings.date,additionalDigits),date=function(dateString,year){if(null===year)return null;let date,month,week;if(!dateString||!dateString.length)return date=new Date(0),date.setUTCFullYear(year),date;let token=patterns.MM.exec(dateString);if(token)return date=new Date(0),month=parseInt(token[1],10)-1,validateDate(year,month)?(date.setUTCFullYear(year,month),date):new Date(NaN);if(token=patterns.DDD.exec(dateString),token){date=new Date(0);const dayOfYear=parseInt(token[1],10);return function(year,dayOfYear){if(dayOfYear<1)return!1;const isLeapYear=isLeapYearIndex(year);if(isLeapYear&&dayOfYear>366)return!1;if(!isLeapYear&&dayOfYear>365)return!1;return!0}(year,dayOfYear)?(date.setUTCFullYear(year,0,dayOfYear),date):new Date(NaN)}if(token=patterns.MMDD.exec(dateString),token){date=new Date(0),month=parseInt(token[1],10)-1;const day=parseInt(token[2],10);return validateDate(year,month,day)?(date.setUTCFullYear(year,month,day),date):new Date(NaN)}if(token=patterns.Www.exec(dateString),token)return week=parseInt(token[1],10)-1,validateWeekDate(week)?dayOfISOWeekYear(year,week):new Date(NaN);if(token=patterns.WwwD.exec(dateString),token){week=parseInt(token[1],10)-1;const dayOfWeek=parseInt(token[2],10)-1;return validateWeekDate(week,dayOfWeek)?dayOfISOWeekYear(year,week,dayOfWeek):new Date(NaN)}return null}(restDateString,year);if(null===date||isNaN(date.getTime()))return new Date(NaN);if(date){const timestamp=date.getTime();let offset,time=0;if(dateStrings.time&&(time=function(timeString){let hours,minutes,token=patterns.HH.exec(timeString);if(token)return hours=parseFloat(token[1].replace(",",".")),validateTime(hours)?hours%24*36e5:NaN;if(token=patterns.HHMM.exec(timeString),token)return hours=parseInt(token[1],10),minutes=parseFloat(token[2].replace(",",".")),validateTime(hours,minutes)?hours%24*36e5+6e4*minutes:NaN;if(token=patterns.HHMMSS.exec(timeString),token){hours=parseInt(token[1],10),minutes=parseInt(token[2],10);const seconds=parseFloat(token[3].replace(",","."));return validateTime(hours,minutes,seconds)?hours%24*36e5+6e4*minutes+1e3*seconds:NaN}return null}(dateStrings.time),null===time||isNaN(time)))return new Date(NaN);if(dateStrings.timeZone||options.timeZone){if(offset=tzParseTimezone(dateStrings.timeZone||options.timeZone,new Date(timestamp+time)),isNaN(offset))return new Date(NaN)}else offset=getTimezoneOffsetInMilliseconds(new Date(timestamp+time)),offset=getTimezoneOffsetInMilliseconds(new Date(timestamp+time+offset));return new Date(timestamp+time+offset)}return new Date(NaN)}function dayOfISOWeekYear(isoWeekYear,week,day){week=week||0,day=day||0;const date=new Date(0);date.setUTCFullYear(isoWeekYear,0,4);const diff=7*week+day+1-(date.getUTCDay()||7);return date.setUTCDate(date.getUTCDate()+diff),date}const DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],DAYS_IN_MONTH_LEAP_YEAR=[31,29,31,30,31,30,31,31,30,31,30,31];function isLeapYearIndex(year){return year%400==0||year%4==0&&year%100!=0}function validateDate(year,month,date){if(month<0||month>11)return!1;if(null!=date){if(date<1)return!1;const isLeapYear=isLeapYearIndex(year);if(isLeapYear&&date>DAYS_IN_MONTH_LEAP_YEAR[month])return!1;if(!isLeapYear&&date>DAYS_IN_MONTH[month])return!1}return!0}function validateWeekDate(week,day){return!(week<0||week>52)&&(null==day||!(day<0||day>6))}function validateTime(hours,minutes,seconds){return!(hours<0||hours>=25)&&((null==minutes||!(minutes<0||minutes>=60))&&(null==seconds||!(seconds<0||seconds>=60)))}function _extends(){return _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}var SubDayOffset;!function(SubDayOffset){SubDayOffset[SubDayOffset.PREV=-1]="PREV",SubDayOffset[SubDayOffset.NEXT=1]="NEXT"}(SubDayOffset||(SubDayOffset={}));const DAY_NUMS=[0,1,2,3,4,5,6],getNextWeekday=(weekday,hiddenDays,offset)=>{let newDay=(weekday+offset+7)%7;if(hiddenDays.length){const direction=offset<0?-1:1;for(;hiddenDays.includes(newDay);)newDay=(newDay+direction+7)%7}return newDay},isDateSatisfyMinDate=(date,minDate)=>!minDate||isAfter(date,minDate)||isSameDay(date,minDate),isDateSatisfyMaxDate=(date,maxDate)=>!maxDate||isBefore(date,maxDate)||isSameDay(date,maxDate),isDateInAllowedRange=(date,minDate,maxDate)=>isDateSatisfyMinDate(date,minDate)&&isDateSatisfyMaxDate(date,maxDate),getSubDates=params=>{const result=[];let date=addDays(params.fromDate,params.ignoreFrom?params.offset:0);for(;result.length<params.numberOfDays;)params.hiddenDays.includes(getDay(date))||result.push(date),date=addDays(date,params.offset);return params.offset===SubDayOffset.PREV?result.reverse():result},tzDate=(date,timezone)=>{var _Intl_DateTimeFormat_resolvedOptions,_Intl_DateTimeFormat,_Intl;return timezone?function(date,timeZone,options){const offsetMilliseconds=tzParseTimezone(timeZone,date=toDate(date,options),!0),d=new Date(date.getTime()-offsetMilliseconds),resultDate=new Date(0);return resultDate.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),resultDate.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),resultDate}(date,timezone||(null==(_Intl=Intl)||null==(_Intl_DateTimeFormat=_Intl.DateTimeFormat())||null==(_Intl_DateTimeFormat_resolvedOptions=_Intl_DateTimeFormat.resolvedOptions())?void 0:_Intl_DateTimeFormat_resolvedOptions.timeZone)):toDate$1(date)},fromTzDate=(date,timezone)=>{var _Intl_DateTimeFormat_resolvedOptions,_Intl_DateTimeFormat,_Intl;return timezone?function(date,timeZone,options){if("string"==typeof date&&!date.match(tzPattern))return toDate(date,{...options,timeZone:timeZone});const utc=newDateUTC((date=toDate(date,options)).getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes(),date.getSeconds(),date.getMilliseconds()).getTime(),offsetMilliseconds=tzParseTimezone(timeZone,new Date(utc));return new Date(utc+offsetMilliseconds)}(date,timezone||(null==(_Intl=Intl)||null==(_Intl_DateTimeFormat=_Intl.DateTimeFormat())||null==(_Intl_DateTimeFormat_resolvedOptions=_Intl_DateTimeFormat.resolvedOptions())?void 0:_Intl_DateTimeFormat_resolvedOptions.timeZone)):toDate$1(date)},getEventEntities=(event,props)=>{const eventStart=toDate$1(event.start),eventEnd=toDate$1(event.end),duration=differenceInMinutes(eventEnd,eventStart),isAllDay=duration>=1439||eventStart.getTime()===eventEnd.getTime()||eventStart.getTime()===startOfDay(eventStart).getTime()&&eventEnd.getTime()===endOfDay(eventEnd).getTime(),tz=isAllDay?void 0:event.timezone||props.timezone,startTz=tz?tzDate(eventStart,tz):eventStart,endTz=tz?tzDate(eventEnd,tz):eventEnd,countDays=differenceInCalendarDays(subMinutes(endTz,1),startTz),durationFormatter=countDays?"dd.MM p":"p",result=[],addEvent=(key,start,end)=>{let uiDuration=duration;const fromChangeable=0!==props.timeFrom||countDays,toChangeable=1440!==props.timeTo||countDays;if(fromChangeable){const sd=startOfDay(start),sdDiff=differenceInMinutes(start,sd);start=set(sd,{minutes:Math.max(props.timeFrom,sdDiff)})}if(toChangeable){const sd=startOfDay(end),sdDiff=differenceInMinutes(end,sd);end=set(sd,{minutes:Math.min(props.timeTo,sdDiff)})}(fromChangeable||toChangeable)&&(uiDuration=differenceInMinutes(end,start)),result.push({key:key,duration:duration,uiDuration:uiDuration,start:start,end:end,countDays:countDays,isAllDay:isAllDay,origin:event,text:event.text||`${props.formatDate(event.start,durationFormatter)} - ${props.formatDate(event.end,durationFormatter)}`})},addEvents=(dateIndex,start,end)=>{for(let i=0;i<=countDays;i++){const eventStarts=addDays(start,i),dayStarts=startOfDay(eventStarts);addEvent(`${event.id}_${i}_${dateIndex}`,0===i?eventStarts:dayStarts,i===countDays?end:endOfDay(eventStarts))}};return!props.ignoreRec&&event.rrule&&RRule$.isInstalled()?RRule$.fromString({rule:event.rrule,startDate:startTz,between:{start:props.startDate,end:addDays(props.endDate,1)}}).forEach(((date,dateIndex)=>{const dayStarts=startOfDay(date),eventStarts=addMinutes(dayStarts,60*startTz.getHours()+startTz.getMinutes()),eventEnds=addMinutes(dayStarts,60*endTz.getHours()+endTz.getMinutes());countDays>0?addEvents(dateIndex,eventStarts,eventEnds):addEvent(`${event.id}_${dayStarts.toString()}`,eventStarts,eventEnds)})):countDays>0?addEvents(0,startTz,endTz):addEvent(event.id,startTz,endTz),result},Context$e=createContext(void 0),useHaptic=()=>useContext(Context$e),Context$d=createContext(void 0),ActionProvider=({children:children,onHeaderSafeAreaPress:onHeaderSafeAreaPress,onAllDayEventsSafeAreaPress:onAllDayEventsSafeAreaPress,onDayHeaderPress:onDayHeaderPress,onLoad:onLoad,onUnavailableTimePress:onUnavailableTimePress,onUnavailableTimeLongPress:onUnavailableTimeLongPress,onDatetimeContextMenu:onDatetimeContextMenu,onDatetimePress:onDatetimePress,onDatetimeLongPress:onDatetimeLongPress,onEventPress:onEventPress,onEventLongPress:onEventLongPress,onEventUpdated:onEventUpdated,onEventCreated:onEventCreated,onChangeScale:onChangeScale,onCollectionHeaderPress:onCollectionHeaderPress})=>jsx(Context$d.Provider,{value:{onHeaderSafeAreaPress:onHeaderSafeAreaPress,onAllDayEventsSafeAreaPress:onAllDayEventsSafeAreaPress,onDayHeaderPress:onDayHeaderPress,onLoad:onLoad,onUnavailableTimePress:onUnavailableTimePress,onUnavailableTimeLongPress:onUnavailableTimeLongPress,onDatetimeContextMenu:onDatetimeContextMenu,onDatetimePress:onDatetimePress,onDatetimeLongPress:onDatetimeLongPress,onEventPress:onEventPress,onEventLongPress:onEventLongPress,onEventUpdated:onEventUpdated,onEventCreated:onEventCreated,onChangeScale:onChangeScale,onCollectionHeaderPress:onCollectionHeaderPress},children:children}),useAction=()=>useContext(Context$d),Context$c=createContext(void 0),ControllerProvider=({children:children,snappable:snappable,draggable:draggable,groupable:groupable,rtl:rtl,isTimelineVisible:isTimelineVisible,isNowIndicatorVisible:isNowIndicatorVisible,isAllDayEventsEnabled:isAllDayEventsEnabled,isAllDayEventsVisible:isAllDayEventsVisible,isDayHeaderVisible:isDayHeaderVisible,isCollectionHeaderVisible:isCollectionHeaderVisible,collections:collections})=>{const isSlow=useRef(!1),controller=useMemo((()=>{const grouping=!!groupable&&!!(null==collections?void 0:collections.length),allDayEventsVisible=null==isAllDayEventsVisible||isAllDayEventsVisible;return{snappable:!!snappable,draggable:!!draggable,groupable:grouping,rtl:!!rtl,isTimelineVisible:null==isTimelineVisible||isTimelineVisible,isNowIndicatorVisible:null==isNowIndicatorVisible||isNowIndicatorVisible,isAllDayEventsEnabled:(null==isAllDayEventsEnabled||isAllDayEventsEnabled)&&allDayEventsVisible,isAllDayEventsVisible:allDayEventsVisible,isDayHeaderVisible:null==isDayHeaderVisible||isDayHeaderVisible,isCollectionHeaderVisible:grouping&&(null==isCollectionHeaderVisible||isCollectionHeaderVisible)}}),[null==collections?void 0:collections.length,draggable,groupable,isAllDayEventsEnabled,isAllDayEventsVisible,isCollectionHeaderVisible,isDayHeaderVisible,isNowIndicatorVisible,isTimelineVisible,rtl,snappable]);return useEffect((()=>{new Promise((resolve=>{const start=performance.now();Array.from({length:100},((_,i)=>i)).sort((()=>Math.random()-.5)),resolve(+(performance.now()-start).toFixed(2)>.1)})).then((slow=>isSlow.current=slow))}),[]),jsx(Context$c.Provider,{value:Object.assign(Object.assign({},controller),{isSlow:isSlow.current}),children:children})},useController=()=>useContext(Context$c),Context$b=createContext(void 0),BASE_COLLECTION={id:"",name:""},useCollection=()=>useContext(Context$b);function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const generateContainer=props=>{const colWeight=1/props.collections.length,dateWeight=1/props.dates.length,collections=props.rtl?props.collections.slice().reverse():props.collections,adjustedDates=props.rtl?props.dates.slice().reverse():props.dates,dateTimes=adjustedDates.map((date=>date.getTime())),dates=collections.flatMap(((collection,colIndex)=>{const collectionOffset=colIndex*colWeight,fromDateIndex=colIndex*props.numberOfDays;return adjustedDates.slice(fromDateIndex,fromDateIndex+props.numberOfDays).map(((date,dateIndex)=>({date:date,offset:props.fromOffset+collectionOffset+dateIndex*dateWeight,collectionId:collection.id})))}));let from=props.fromOffset,to=props.fromOffset;if(props.snappable){if(props.minDate){const offsets=dates.filter((props.rtl,({date:date})=>isDateSatisfyMinDate(date,props.minDate))).map((({offset:offset})=>offset));from=offsets.length?props.rtl?Math.max(...offsets):Math.min(...offsets):null}if(props.maxDate){const offsets=dates.filter((props.rtl,({date:date})=>isDateSatisfyMaxDate(date,props.maxDate))).map((({offset:offset})=>offset));to=offsets.length?props.rtl?Math.min(...offsets):Math.max(...offsets):null}}else props.minDate&&(from=isDateSatisfyMinDate(dates[props.rtl?0:dates.length-1].date,props.minDate)?props.fromOffset:null),props.maxDate&&(to=isDateSatisfyMaxDate(dates[props.rtl?dates.length-1:0].date,props.maxDate)?props.fromOffset:null);return{dates:dates,from:from,to:to,offset:props.fromOffset,maxTime:Math.max(...dateTimes),minTime:Math.min(...dateTimes),collections:collections.map((collection=>collection.id))}},generateInitialContainers=props=>{const initialDates=(params=>{const result=[];if(params.numberOfDays>=5){const sortedDays=[...DAY_NUMS.slice(params.weekStartsOn),...DAY_NUMS.slice(0,params.weekStartsOn)],lastDayNum=sortedDays[sortedDays.length-1],beforeLastDay=sortedDays[sortedDays.length-2],currentDay=getDay(params.fromDate);let start=startOfWeek(params.fromDate,{weekStartsOn:params.weekStartsOn});params.numberOfDays<7&&!params.hiddenDays.length&&(5===params.numberOfDays&&[beforeLastDay,lastDayNum].includes(currentDay)&&(start=addDays(start,currentDay===beforeLastDay?1:2)),6===params.numberOfDays&&lastDayNum===currentDay&&(start=addDays(start,1)));let offset=differenceInDays(start,params.fromDate);for(;offset<0&&result.length<params.numberOfDays;){const prevDate=addDays(params.fromDate,offset);params.hiddenDays.includes(getDay(prevDate))||result.push(prevDate),offset+=1}}return[...result,...result.length<params.numberOfDays?getSubDates(_extends({},params,{numberOfDays:params.numberOfDays-result.length,offset:SubDayOffset.NEXT,ignoreFrom:!1})):[]]})(props),initialContainer=generateContainer({fromOffset:props.fromOffset,numberOfDays:props.numberOfDays,rtl:props.rtl,snappable:props.snappable,minDate:props.minDate,maxDate:props.maxDate,collections:props.collections.slice(props.fromCollectionIndex,props.fromCollectionIndex+props.numberOfCollections),dates:Array.from({length:props.numberOfCollections}).flatMap((()=>initialDates))}),subsequentProps=Object.assign(Object.assign({},props),{fromContainer:initialContainer});return[...generatePrevContainers(subsequentProps),initialContainer,...generateNextContainers(subsequentProps)]},generatePrevContainers=props=>{const containers=[],totalCollections=props.collections.length-1,indexMultiplier=props.rtl?-1:1,{collectionId:collectionId}=props.fromContainer.dates[props.rtl?props.fromContainer.dates.length-1:0];let collectionIndex=props.collections.slice().reverse().findIndex((collection=>collectionId===collection.id));for(let i=0;i<5;i++){const collections=[];for(;collections.length<props.numberOfCollections;){const adjustedCollectionIndex=totalCollections-++collectionIndex%props.collections.length;collections.unshift({index:adjustedCollectionIndex,collection:props.collections[adjustedCollectionIndex]})}containers.push(generateContainer({fromOffset:props.fromOffset-(i+1)*indexMultiplier,numberOfDays:props.numberOfDays,rtl:props.rtl,snappable:props.snappable,minDate:props.minDate,maxDate:props.maxDate,collections:collections.map((({collection:collection})=>collection)),dates:collections.slice().reverse().reduce(((arr,{index:index})=>{var _a,_b;const adjustedDatesDates=props.rtl?arr[0]||((null===(_a=containers.at(-1))||void 0===_a?void 0:_a.dates)||props.fromContainer.dates).slice().reverse().map((({date:date})=>date)).slice(0,props.numberOfDays):arr[0]||((null===(_b=containers.at(-1))||void 0===_b?void 0:_b.dates)||props.fromContainer.dates).map((({date:date})=>date)).slice(0,props.numberOfDays);return index!==totalCollections?[adjustedDatesDates,...arr]:[getSubDates({fromDate:adjustedDatesDates[0],hiddenDays:props.hiddenDays,offset:-1,numberOfDays:props.numberOfDays,ignoreFrom:!0}),...arr]}),[]).flat()}))}return containers},generateNextContainers=props=>{const containers=[],indexMultiplier=props.rtl?-1:1,{collectionId:collectionId}=props.fromContainer.dates[props.rtl?0:props.fromContainer.dates.length-1];let collectionIndex=props.collections.findIndex((collection=>collectionId===collection.id));for(let i=0;i<5;i++){const collections=[];for(;collections.length<props.numberOfCollections;){const adjustedCollectionIndex=++collectionIndex%props.collections.length;collections.push({index:adjustedCollectionIndex,collection:props.collections[adjustedCollectionIndex]})}containers.push(generateContainer({fromOffset:props.fromOffset+(i+1)*indexMultiplier,numberOfDays:props.numberOfDays,rtl:props.rtl,snappable:props.snappable,minDate:props.minDate,maxDate:props.maxDate,collections:collections.map((({collection:collection})=>collection)),dates:collections.reduce(((arr,{index:index})=>{var _a,_b;const adjustedDatesDates=props.rtl?arr.at(-1)||((null===(_a=containers.at(-1))||void 0===_a?void 0:_a.dates)||props.fromContainer.dates).slice().reverse().map((({date:date})=>date)).slice(-props.numberOfDays):arr.at(-1)||((null===(_b=containers.at(-1))||void 0===_b?void 0:_b.dates)||props.fromContainer.dates).map((({date:date})=>date)).slice(-props.numberOfDays);return 0!==index?[...arr,adjustedDatesDates]:[...arr,getSubDates({fromDate:adjustedDatesDates.at(-1),hiddenDays:props.hiddenDays,offset:1,numberOfDays:props.numberOfDays,ignoreFrom:!0})]}),[]).flat()}))}return containers},adjustWeekStartsOn=(weekStartsOn=0)=>Math.min(6,Math.round(Math.abs(weekStartsOn))),adjustNumberOfDays=numberOfDays=>numberOfDays?Math.abs(Math.round(numberOfDays)):1,useRestoreApp=callback=>{const{appState:appState}=(()=>{const[appState,setAppState]=useState(AppState.currentState);return useEffect((()=>{const subscription=AppState.addEventListener("change",setAppState);return()=>{subscription.remove()}}),[appState]),{appState:appState}})(),lastAppStateRef=useRef(appState);useEffect((()=>{"background"===lastAppStateRef.current&&"active"===appState&&callback(),lastAppStateRef.current=appState}),[appState,callback])};var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},timers={};Object.defineProperty(timers,"__esModule",{value:!0}),timers.jestFakeTimersAreEnabled=timers.clearTimeout=void 0,timers.runWithRealTimers=runWithRealTimers;var setTimeout$1=timers.setTimeout=timers.setImmediate=void 0;const globalObj="undefined"==typeof window?commonjsGlobal:window;function runWithRealTimers(callback){const fakeTimersType=getJestFakeTimersType();fakeTimersType&&jest.useRealTimers();const callbackReturnValue=callback();if(fakeTimersType){const fakeTimersConfig="legacy"===fakeTimersType?{legacyFakeTimers:!0}:{legacyFakeTimers:!1};jest.useFakeTimers(fakeTimersConfig)}return callbackReturnValue}function getJestFakeTimersType(){if("undefined"==typeof jest||void 0===globalObj.setTimeout||process.env.RNTL_SKIP_AUTO_DETECT_FAKE_TIMERS)return null;if(void 0!==globalObj.setTimeout._isMockFunction&&globalObj.setTimeout._isMockFunction)return"legacy";if(void 0!==globalObj.setTimeout.clock&&void 0!==jest.getRealSystemTime)try{return jest.getRealSystemTime(),"modern"}catch{}return null}function setImmediatePolyfill(fn){return globalObj.setTimeout(fn,0)}timers.jestFakeTimersAreEnabled=()=>Boolean(getJestFakeTimersType());const{clearTimeoutFn:clearTimeoutFn,setImmediateFn:setImmediateFn,setTimeoutFn:setTimeoutFn}=runWithRealTimers((function(){return{clearTimeoutFn:globalObj.clearTimeout,setImmediateFn:globalObj.setImmediate||setImmediatePolyfill,setTimeoutFn:globalObj.setTimeout}}));setTimeout$1=timers.setTimeout=setTimeoutFn,timers.setImmediate=setImmediateFn,timers.clearTimeout=clearTimeoutFn;const Context$a=createContext(void 0),DatetimeProvider=({timezone:timezone,weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,minDate:minDate,maxDate:maxDate,numberOfDays:numberOfDays,timeFrom:timeFrom,timeTo:timeTo,timeInterval:timeInterval,timeStep:timeStep,locale:locale,dayHeaderTextFormat:dayHeaderTextFormat,timelineTextFormat:timelineTextFormat,children:children})=>{const timeSlotsRef=useRef([]),hiddenDaysRef=useRef([]),[now,setNow]=useState(tzDate(new Date,timezone)),datetime=useMemo((()=>{const from=(timeFrom=>timeFrom?Math.max(Math.round(timeFrom),0):0)(timeFrom),to=(timeTo=>timeTo?Math.min(Math.round(timeTo),1440):1440)(timeTo),adjustedFrom=Math.min(from,to),adjustedTo=Math.max(from,to),interval=(timeInterval=>timeInterval?Math.abs(Math.round(timeInterval)):60)(timeInterval),distance=adjustedTo-adjustedFrom,timeSlots=[],hd=(hiddenDays=>hiddenDays?[...new Set(hiddenDays.filter((day=>day<7)))].sort().slice(0,6):[])(hiddenDays);let currentSlot=adjustedFrom;for(;currentSlot<=adjustedTo;)timeSlots.push(currentSlot),currentSlot+=interval;return timeSlots.length===timeSlotsRef.current.length&&timeSlots.every((slot=>timeSlotsRef.current.includes(slot)))||(timeSlotsRef.current=timeSlots),hd.length===hiddenDaysRef.current.length&&hd.every((day=>hiddenDaysRef.current.includes(day)))||(hiddenDaysRef.current=hd),{timeSlots:timeSlotsRef.current,hiddenDays:hiddenDaysRef.current,weekStartsOn:adjustWeekStartsOn(weekStartsOn),minDate:minDate&&startOfDay(tzDate(minDate,timezone)),maxDate:maxDate&&startOfDay(tzDate(maxDate,timezone)),numberOfDays:adjustNumberOfDays(numberOfDays),timeFrom:adjustedFrom,timeTo:adjustedTo,timeDistance:distance,timeInterval:interval,timeWeight:100/distance,timeUnit:distance/100,timeStep:Math.min(timeStep?Math.abs(timeStep):15,distance),dayHeaderTextFormat:dayHeaderTextFormat||"EEEEEE dd",timelineTextFormat:timelineTextFormat||"p"}}),[timeFrom,timeTo,timeInterval,weekStartsOn,hiddenDays,minDate,timezone,maxDate,numberOfDays,timeStep,dayHeaderTextFormat,timelineTextFormat]),formatDate=useCallback(((date,formatSrt)=>format(date,formatSrt,{locale:locale})),[locale]),isDateInRange=useCallback((date=>{const start=addMinutes(date,datetime.timeFrom),end=addMinutes(date,datetime.timeTo-1);return eachDayOfInterval({start:start,end:end}).some((intervalDate=>!datetime.hiddenDays.includes(intervalDate.getDay())&&isSameDay(intervalDate,now)))}),[now,datetime.timeFrom,datetime.timeTo,datetime.hiddenDays]);return useRestoreApp((()=>{setNow(tzDate(new Date,timezone))})),useEffect((()=>{const date=new Date,timeout=setTimeout$1((()=>setNow(tzDate(date,timezone))),1e3*(60-date.getSeconds()));return()=>clearTimeout(timeout)}),[timezone,now]),jsx(Context$a.Provider,{value:Object.assign(Object.assign({},datetime),{now:now,timezone:timezone,locale:locale,formatDate:formatDate,isDateInRange:isDateInRange,setNow:setNow}),children:children})},useDatetime=()=>useContext(Context$a),Context$9=createContext(void 0),DimensionProvider=({children:children,horizontalLineSize:horizontalLineSize,gridVerticalPadding:gridVerticalPadding,allDayEventHeight:allDayEventHeight,dayHeaderHeight:dayHeaderHeight,collectionHeaderHeight:collectionHeaderHeight,timelineWidth:timelineWidth,width:width,nowIndicatorHeight:nowIndicatorHeight,eventBorderWidth:eventBorderWidth,eventBorderRadius:eventBorderRadius})=>{const windowDimensions=useWindowDimensions(),{numberOfDays:numberOfDays}=useDatetime(),{rtl:rtl,isTimelineVisible:isTimelineVisible,isDayHeaderVisible:isDayHeaderVisible,isCollectionHeaderVisible:isCollectionHeaderVisible}=useController(),collection=useCollection(),timegridWidth=useMemo((()=>width||windowDimensions.width),[width,windowDimensions.width]),dimensions=useMemo((()=>{const headerHeight={coll:collectionHeaderHeight||30,day:dayHeaderHeight||50},tmlWidth=isTimelineVisible?timelineWidth||58:0,collWidth=100/((null==collection?void 0:collection.numberOfCollections)||1),columnWidth=collWidth/numberOfDays,containerWidth=timegridWidth-tmlWidth;return{containerWidth:containerWidth,columnUnit:columnWidth/100,containerUnit:containerWidth/100,containerWeight:100/containerWidth,verticalLineSize:1,horizontalLineSize:Math.max(null!=horizontalLineSize?horizontalLineSize:.5,0),gridVerticalPadding:gridVerticalPadding||0,allDayEventHeight:allDayEventHeight||25,collectionHeaderHeight:headerHeight.coll,timelineWidth:tmlWidth,timelineLeftWidth:rtl?0:tmlWidth,collectionWidth:collWidth,columnWidth:columnWidth,dayHeaderHeight:headerHeight.day,nowIndicatorHeight:Math.max(nowIndicatorHeight||.5,0),headerHeight:(isDayHeaderVisible?headerHeight.day:0)+(isCollectionHeaderVisible?headerHeight.coll:0),containerLeft:rtl?void 0:tmlWidth,containerRight:rtl?tmlWidth:void 0,hlLeft:rtl?void 0:tmlWidth,hlRight:rtl?tmlWidth:void 0,eventBorderWidth:eventBorderWidth||1,eventBorderRadius:eventBorderRadius||5}}),[rtl,allDayEventHeight,collectionHeaderHeight,dayHeaderHeight,gridVerticalPadding,horizontalLineSize,isCollectionHeaderVisible,isDayHeaderVisible,isTimelineVisible,nowIndicatorHeight,numberOfDays,timegridWidth,timelineWidth,eventBorderWidth,eventBorderRadius,null==collection?void 0:collection.numberOfCollections]);return jsx(Context$9.Provider,{value:Object.assign({timegridWidth:timegridWidth},dimensions),children:children})},useDimension=()=>useContext(Context$9),Context$8=createContext(void 0),ScrollProvider=({children:children})=>{const{snappable:snappable,rtl:rtl,groupable:groupable}=useController(),{columnWidth:columnWidth}=useDimension(),scrollYRef=useRef(null),scrollYMeasureRef=useRef({x:0,y:0,width:0,height:0}),[scrollableY,setScrollableY]=useState(!0),autoScrolling$=useSharedValue(!1),lastScrollX$=useSharedValue(0),scrollX$=useSharedValue(0),scrollY$=useSharedValue(0),scrolling$=useDerivedValue((()=>autoScrolling$.value||scrollX$.value!==lastScrollX$.value),[]),scrollXOffset=useMemo((()=>snappable&&rtl&&!groupable?100-columnWidth:0),[columnWidth,groupable,rtl,snappable]),adjustedScrollX$=useDerivedValue((()=>scrollX$.value+scrollXOffset),[scrollXOffset]),scrollYTo=useCallback((params=>{var _a;null===(_a=scrollYRef.current)||void 0===_a||_a.scrollTo({y:params.value,animated:!!params.animated})}),[]),scrollXTo=useCallback((params=>new Promise((resolve=>{autoScrolling$.value=!0,lastScrollX$.value=params.value,scrollX$.value=withSpring(params.value,params.animated?{velocity:isWeb?void 0:params.velocity,damping:1e3,stiffness:500}:{duration:1},(()=>{runOnJS(resolve)(),autoScrolling$.value=!1}))}))),[]);return jsx(Context$8.Provider,{value:{scrollYRef:scrollYRef,scrollYMeasureRef:scrollYMeasureRef,scrollableY:scrollableY,scrolling$:scrolling$,scrollY$:scrollY$,lastScrollX$:lastScrollX$,scrollX$:scrollX$,adjustedScrollX$:adjustedScrollX$,scrollYTo:scrollYTo,scrollXTo:scrollXTo,setScrollableY:setScrollableY},children:children})},useScroll=()=>useContext(Context$8),Context$7=createContext(void 0),ContainerProvider=({children:children,selectedDateRef:selectedDateRef,setSelectedDate:setSelectedDate})=>{const{numberOfDays:numberOfDays,minDate:minDate,maxDate:maxDate,weekStartsOn:weekStartsOn,hiddenDays:hiddenDays}=useDatetime(),{snappable:snappable,groupable:groupable,rtl:rtl}=useController(),{scrollXTo:scrollXTo}=useScroll(),collection=useCollection(),haptic=useHaptic(),containersRef=useRef(new Map),containersOffsetRef=useRef({min:0,max:0,active:0}),[activeContainers,setActiveContainers]=useState([]),buffer=useMemo((()=>snappable?2:1),[snappable]),getContainersBuffer=useCallback((offset=>Array.from({length:2*buffer+1}).map(((_,i)=>containersRef.current.get(i-buffer+Math.floor(offset)))).filter(Boolean)),[buffer]),handleOffset=useCallback((offset=>{const containers=getContainersBuffer(offset);containersOffsetRef.current={min:Math.min(...containers.map(rtl?({to:to})=>to:({from:from})=>from).filter((value=>null!==value))),max:Math.max(...containers.map(rtl?({from:from})=>from:({to:to})=>to).filter((value=>null!==value))),active:offset},setActiveContainers(containers)}),[getContainersBuffer,rtl]),initContainers=useCallback(((fromDate,fromCollectionIndex,params)=>__awaiter(void 0,0,void 0,(function*(){let initOffset=0;const adjustedFromDate=startOfDay(fromDate),initialDate=(null==params?void 0:params.ignoreLimit)?adjustedFromDate:((date,minDate,maxDate)=>minDate&&!isDateSatisfyMinDate(date,minDate)?minDate:maxDate&&!isDateSatisfyMaxDate(date,maxDate)?maxDate:date)(adjustedFromDate,minDate,maxDate),containers=generateInitialContainers({numberOfDays:numberOfDays,numberOfCollections:(null==collection?void 0:collection.numberOfCollections)||1,weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,rtl:rtl,snappable:snappable,minDate:minDate,maxDate:maxDate,collections:(null==collection?void 0:collection.items)||[BASE_COLLECTION],fromCollectionIndex:fromCollectionIndex,fromOffset:initOffset,fromDate:initialDate});if(containersRef.current.clear(),containers.forEach((container=>containersRef.current.set(container.offset,container))),snappable&&!groupable){const targetDate=containers[5].dates.find((({date:date})=>isSameDay(initialDate,date)));targetDate&&(initOffset=targetDate.offset)}handleOffset(initOffset),yield scrollXTo({value:100*-initOffset,animated:null==params?void 0:params.animated})}))),[handleOffset,groupable,hiddenDays,maxDate,minDate,numberOfDays,rtl,snappable,weekStartsOn,null==collection?void 0:collection.numberOfCollections,null==collection?void 0:collection.items,scrollXTo]),addContainers=useCallback((offset=>{const offsetProps={rtl:rtl,snappable:snappable,minDate:minDate,maxDate:maxDate,numberOfDays:numberOfDays,numberOfCollections:(null==collection?void 0:collection.numberOfCollections)||1,collections:(null==collection?void 0:collection.items)||[BASE_COLLECTION],hiddenDays:hiddenDays,fromOffset:offset,fromContainer:containersRef.current.get(offset)};((rtl?offset<0:offset>0)?generateNextContainers(offsetProps):generatePrevContainers(offsetProps)).forEach((container=>containersRef.current.set(container.offset,container)))}),[rtl,snappable,minDate,maxDate,numberOfDays,hiddenDays,null==collection?void 0:collection.numberOfCollections,null==collection?void 0:collection.items]),setContainersOffset=useCallback(((nextOffset,ignoreDateSelection)=>{var _a,_b,_c,_d;const accumulation=((offset,buffer)=>5*Math.floor((Math.abs(offset)+buffer)/5)*(offset<=-5+buffer?-1:1))(nextOffset,buffer);if(containersRef.current.has(accumulation+5*(nextOffset<0?-1:1))||addContainers(accumulation),!ignoreDateSelection&&nextOffset!==containersOffsetRef.current.active){let nextSelectedDate,dates=null===(_a=containersRef.current.get(Math.floor(nextOffset)))||void 0===_a?void 0:_a.dates;if(!dates)return;!snappable||snappable&&groupable?(rtl&&(dates=dates.slice().reverse()),nextSelectedDate=null===(_b=dates.find((({date:date,offset:offset})=>offset>=nextOffset&&isDateInAllowedRange(date,minDate,maxDate))))||void 0===_b?void 0:_b.date):nextSelectedDate=null===(_c=dates.find((({date:date,offset:offset})=>offset>=nextOffset&&isDateInAllowedRange(date,minDate,maxDate))))||void 0===_c?void 0:_c.date,nextSelectedDate&&!isSameDay(selectedDateRef.current,nextSelectedDate)&&(setSelectedDate(nextSelectedDate),null===(_d=null==haptic?void 0:haptic.emitImpact)||void 0===_d||_d.call(haptic,"onChangeDate"))}containersOffsetRef.current.active!==nextOffset&&handleOffset(nextOffset)}),[addContainers,buffer,handleOffset,groupable,maxDate,minDate,rtl,snappable,setSelectedDate,null==haptic?void 0:haptic.emitImpact]),getActiveContainers=useCallback((()=>getContainersBuffer(containersOffsetRef.current.active)),[getContainersBuffer]),getActiveContainersDates=useCallback((()=>getActiveContainers().flatMap((({dates:dates})=>dates)).filter((({offset:offset})=>rtl&&snappable&&!groupable?offset>containersOffsetRef.current.active-.99&&offset<=containersOffsetRef.current.active:offset>=containersOffsetRef.current.active&&offset<containersOffsetRef.current.active+.99))),[getActiveContainers,rtl,snappable,groupable]),moveContainers=useCallback(((moveOffset,velocity)=>__awaiter(void 0,0,void 0,(function*(){var _a;const{min:min,active:active,max:max}=containersOffsetRef.current,dates=getActiveContainers().flatMap((({dates:dates})=>dates));let nextOffset;if(snappable){const targetDateIndex=dates.findIndex((({offset:offset})=>offset.toFixed(3)===active.toFixed(3)));nextOffset=null===(_a=dates[targetDateIndex+moveOffset*(groupable?numberOfDays:1)])||void 0===_a?void 0:_a.offset}else nextOffset=active+moveOffset;void 0===nextOffset?nextOffset=active:nextOffset<min?nextOffset=min:nextOffset>max&&(nextOffset=max),nextOffset!==containersOffsetRef.current.active&&setContainersOffset(nextOffset),yield scrollXTo({value:100*-nextOffset,animated:!0,velocity:velocity})}))),[getActiveContainers,snappable,scrollXTo,groupable,numberOfDays,setContainersOffset]);return useEffect((()=>{initContainers(selectedDateRef.current,0)}),[]),jsx(Context$7.Provider,{value:{containersRef:containersRef,containersOffsetRef:containersOffsetRef,activeContainers:activeContainers,initContainers:initContainers,setContainersOffset:setContainersOffset,moveContainers:moveContainers,getActiveContainers:getActiveContainers,getActiveContainersDates:getActiveContainersDates},children:children})},useContainer=()=>useContext(Context$7),Context$6=createContext(void 0),EventProvider=({children:children,events:events,allDayEventsSafeAreaText:allDayEventsSafeAreaText,createEventDuration:createEventDuration})=>{const{groupable:groupable}=useController(),{timezone:timezone,timeFrom:timeFrom,timeTo:timeTo,formatDate:formatDate}=useDatetime(),{activeContainers:activeContainers,getActiveContainers:getActiveContainers,getActiveContainersDates:getActiveContainersDates}=useContainer(),eventsRef=useRef({}),eventsByOffsetRef=useRef({}),[eventsByOffset,setEventsByOffset]=useState({}),[draggableEvent,setDraggableEvent]=useState(),eventDuration=useMemo((()=>createEventDuration?Math.max(5,Math.ceil(createEventDuration)):60),[createEventDuration]),activeAllDayEvents=useMemo((()=>Object.values(eventsByOffset).flat().filter((event=>event.isAllDay))),[eventsByOffset]),maxAllDayEventsByOffset=useMemo((()=>Math.max(1,...getActiveContainersDates().map((({offset:offset})=>activeAllDayEvents.filter((event=>event.offset===offset)).length)))),[activeAllDayEvents,getActiveContainersDates]),handleEvents=useCallback((()=>{if(null==events?void 0:events.length){const validIds={},newEvents=[],forDate=new Date;let hasRecurrenceEvents=!1;events.forEach((event=>{var _a;const refArr=eventsRef.current[event.id];refArr&&objectsEqual(event,null===(_a=refArr[0])||void 0===_a?void 0:_a.origin)?validIds[event.id]=!0:newEvents.push(event)})),Object.keys(eventsRef.current).forEach((id=>{validIds[id]||delete eventsRef.current[id]})),newEvents.forEach((event=>{event.rrule&&!hasRecurrenceEvents&&(hasRecurrenceEvents=!0),eventsRef.current[event.id]=getEventEntities(event,{ignoreRec:!0,timezone:timezone,timeFrom:timeFrom,timeTo:timeTo,formatDate:formatDate,startDate:forDate,endDate:forDate})})),hasRecurrenceEvents&&!RRule$.isInstalled()&&RRule$.showInstallationWarning()}else eventsRef.current={}}),[events,timeFrom,timeTo,timezone,formatDate]),handleActiveContainers=useCallback((()=>{const containers=getActiveContainers();if(!containers.length)return;const pendingContainers=containers.filter((({offset:offset})=>!eventsByOffsetRef.current[offset]));if(pendingContainers.length){const minDate=Math.min(...pendingContainers.map((({minTime:minTime})=>minTime))),maxDate=Math.max(...pendingContainers.map((({maxTime:maxTime})=>maxTime))),events=[],recEvents=[];Object.values(eventsRef.current).flat().forEach((event=>{event.origin.rrule&&!recEvents.some((recEvent=>recEvent.id===event.origin.id))?recEvents.push(event.origin):isDateInAllowedRange(event.start,minDate,maxDate)&&events.push(event)})),recEvents.length&&recEvents.forEach((event=>{const entities=getEventEntities(event,{ignoreRec:!1,timezone:timezone,timeFrom:timeFrom,timeTo:timeTo,formatDate:formatDate,startDate:new Date(minDate),endDate:new Date(maxDate)});events.push(...entities)})),pendingContainers.forEach((({offset:offset,dates:dates})=>{eventsByOffsetRef.current[offset]=dates.flatMap((({date:date,collectionId:collectionId,offset:offset})=>events.filter((event=>(!groupable||!event.origin.collectionId||event.origin.collectionId===collectionId)&&isSameDay(event.start,date))).map((event=>Object.assign(Object.assign({},event),{offset:offset}))))).reduce(((uniqEvents,event)=>uniqEvents.some((({origin:origin,offset:offset})=>origin.id===event.origin.id&&offset===event.offset))?uniqEvents:[...uniqEvents,event]),[])}))}setEventsByOffset(containers.reduce(((obj,{offset:offset})=>Object.assign(Object.assign({},obj),{[offset]:eventsByOffsetRef.current[offset]})),{}))}),[groupable,timeFrom,timeTo,timezone,formatDate,getActiveContainers]),clearEventsCache=useCallback((()=>{eventsByOffsetRef.current={}}),[]);return useEffect((()=>{clearEventsCache(),handleEvents()}),[clearEventsCache,handleEvents]),useEffect((()=>{activeContainers.length&&handleActiveContainers()}),[events,handleActiveContainers,activeContainers]),jsx(Context$6.Provider,{value:{draggableEvent:draggableEvent,clearEventsCache:clearEventsCache,eventsByOffset:eventsByOffset,activeAllDayEvents:activeAllDayEvents,maxAllDayEventsByOffset:maxAllDayEventsByOffset,allDayEventsSafeAreaText:allDayEventsSafeAreaText,createEventDuration:eventDuration,setDraggableEvent:setDraggableEvent},children:children})},useEvent=()=>useContext(Context$6),getUnavailableTimeForDates=props=>{const result=[];return props.dates.forEach((({date:date,collectionId:collectionId},dateIndex)=>{const filteredUnavailableTime=props.unavailableTime.filter((({origin:origin})=>!props.groupable||!origin.collectionId||origin.collectionId===collectionId)),unavailableDates=filteredUnavailableTime.filter((({date:date})=>!!date)),unavailableRanges=filteredUnavailableTime.filter((({start:start,end:end})=>start||end)),unavailableWeekdays=filteredUnavailableTime.filter((({weekday:weekday})=>void 0!==weekday));filteredUnavailableTime.forEach(((unavailableTime,unavailableTimeIndex)=>{const pushItem=()=>{result.push(Object.assign(Object.assign({},unavailableTime),{key:`${date}_${dateIndex}_${unavailableTimeIndex}}`,columns:{start:dateIndex,count:1}}))},expandOrPushItem=()=>{const expandableItem=result.find((({from:from,to:to,columns:columns})=>from===unavailableTime.from&&to===unavailableTime.to&&dateIndex===columns.start+columns.count));expandableItem?expandableItem.columns.count+=1:pushItem()};unavailableTime.date?isSameDay(unavailableTime.date,date)&&pushItem():unavailableDates.length&&unavailableDates.some((({dayOffset:dayOffset,date:unavailableDate})=>dayOffset===unavailableTime.dayOffset&&isSameDay(unavailableDate,date)))||(unavailableTime.start||unavailableTime.end?unavailableTime.start&&isBefore(date,startOfDay(unavailableTime.start))||unavailableTime.end&&isAfter(date,startOfDay(unavailableTime.end))||props.hiddenDays.includes(addDays(date,-unavailableTime.dayOffset).getDay())||expandOrPushItem():unavailableRanges.length&&unavailableRanges.some((({dayOffset:dayOffset,start:start,end:end})=>!(dayOffset!==unavailableTime.dayOffset||start&&isBefore(date,startOfDay(start))||end&&isAfter(date,startOfDay(end)))))||(void 0!==unavailableTime.weekday?unavailableTime.weekday===date.getDay()&&pushItem():unavailableWeekdays.length&&unavailableWeekdays.some((({dayOffset:dayOffset,weekday:weekday})=>dayOffset===unavailableTime.dayOffset&&weekday===date.getDay()))||expandOrPushItem()))}))})),result},Context$5=createContext(void 0),UtProvider=({unavailableTime:unavailableTime,children:children})=>{const{hiddenDays:hiddenDays,maxDate:maxDate,minDate:minDate,timeFrom:timeFrom,timeTo:timeTo,timezone:timezone}=useDatetime(),{groupable:groupable}=useController(),{activeContainers:activeContainers,getActiveContainers:getActiveContainers}=useContainer(),utByOffsetRef=useRef({}),[utByOffset,setUtByOffset]=useState({}),ut=useMemo((()=>{const arr=unavailableTime||[];return minDate&&arr.push({from:0,to:1440,start:addDays(minDate,-36500),end:addDays(minDate,-1)}),maxDate&&arr.push({from:0,to:1440,start:addDays(maxDate,1),end:addDays(maxDate,36500)}),arr.length?(props=>{const unavailableTime=[],today=new Date,daysCount=Math.ceil(1440/(props.timeTo-props.timeFrom)),offset=Math.floor(props.timeFrom/1440),timezoneOffset=props.timezone?differenceInMinutes(tzDate(today,props.timezone),today):0;return props.unavailableTime.filter((({weekday:weekday,date:date})=>!(void 0!==weekday&&props.hiddenDays.includes(weekday)||date&&props.hiddenDays.includes(toDate$1(date).getDay())))).forEach((origin=>{for(let day=0;day<daysCount;day++){const timeOffset=1440*day+timezoneOffset,dayOffset=day+offset&&-(day+offset);unavailableTime.push({origin:origin,dayOffset:dayOffset,from:Math.max(origin.from+timeOffset,props.timeFrom),to:Math.min(origin.to+timeOffset,props.timeTo-props.timeFrom),start:origin.start?addDays(origin.start,dayOffset):void 0,end:origin.end?addDays(origin.end,dayOffset):void 0,date:origin.date?addDays(origin.date,dayOffset):void 0,weekday:void 0!==origin.weekday?getNextWeekday(origin.weekday,props.hiddenDays,dayOffset):void 0})}})),unavailableTime.sort(((a,b)=>a.date&&!b.date?-1:!a.date&&b.date?1:!a.start&&!a.end||b.start||b.end?a.start||a.end||!b.start&&!b.end?void 0!==a.weekday&&void 0===b.weekday?-1:void 0===a.weekday&&void 0!==b.weekday?1:0:1:-1))})({timeFrom:timeFrom,timeTo:timeTo,hiddenDays:hiddenDays,timezone:timezone,unavailableTime:arr}):[]}),[hiddenDays,maxDate,minDate,timeFrom,timeTo,timezone,unavailableTime]),handleActiveContainers=useCallback((()=>{const containers=getActiveContainers();containers.length&&setUtByOffset(containers.reduce(((obj,container)=>{let value=utByOffsetRef.current[container.offset];return value||(value=(null==ut?void 0:ut.length)?getUnavailableTimeForDates({groupable:groupable,hiddenDays:hiddenDays,unavailableTime:ut,dates:container.dates}):[],utByOffsetRef.current[container.offset]=value),Object.assign(Object.assign({},obj),{[container.offset]:value})}),{}))}),[groupable,hiddenDays,timeFrom,timeTo,ut,getActiveContainers]),clearUtCache=useCallback((()=>{utByOffsetRef.current={}}),[]);return useEffect((()=>{clearUtCache()}),[unavailableTime,clearUtCache]),useEffect((()=>{activeContainers.length&&handleActiveContainers()}),[handleActiveContainers,activeContainers]),jsx(Context$5.Provider,{value:{utByOffset:utByOffset,clearUtCache:clearUtCache},children:children})},useUt=()=>useContext(Context$5),Context$4=createContext(void 0),OperationProvider=({selectedDateRef:selectedDateRef,children:children,scaleRef:scaleRef,setSelectedDate:setSelectedDate})=>{const{hiddenDays:hiddenDays,minDate:minDate,maxDate:maxDate,timeFrom:timeFrom,timeStep:timeStep,timeWeight:timeWeight,timeUnit:timeUnit,timezone:timezone,setNow:setNow}=useDatetime(),{groupable:groupable,rtl:rtl,snappable:snappable}=useController(),{containerWeight:containerWeight,timelineLeftWidth:timelineLeftWidth,columnWidth:columnWidth,gridVerticalPadding:gridVerticalPadding}=useDimension(),{scrollX$:scrollX$,adjustedScrollX$:adjustedScrollX$,scrollY$:scrollY$,scrolling$:scrolling$,scrollYMeasureRef:scrollYMeasureRef,scrollXTo:scrollXTo,scrollYTo:scrollYTo}=useScroll(),{containersOffsetRef:containersOffsetRef,containersRef:containersRef,initContainers:initContainers,setContainersOffset:setContainersOffset,getActiveContainers:getActiveContainers,getActiveContainersDates:getActiveContainersDates}=useContainer(),{clearUtCache:clearUtCache}=useUt(),{createEventDuration:createEventDuration,setDraggableEvent:setDraggableEvent,clearEventsCache:clearEventsCache}=useEvent(),collection=useCollection(),haptic=useHaptic(),reset=useCallback((params=>__awaiter(void 0,0,void 0,(function*(){setDraggableEvent(void 0),setNow(tzDate(new Date,timezone)),setSelectedDate(params.date),clearEventsCache(),clearUtCache(),scrollX$.value=params.offset?100*params.offset:0,yield initContainers(params.date,params.collectionIndex,params)}))),[timezone,setSelectedDate,clearEventsCache,clearUtCache,initContainers]),getOffsetDate=useCallback(((offset,params)=>{const followingDate=((fromDate,hiddenDays,offset)=>{let date=addDays(fromDate,offset),i=0;for(;i<7;){if(!hiddenDays.includes(getDay(date)))return date;date=addDays(date,offset),i+=1}throw new Error("No available day of the week found")})(startOfDay(selectedDateRef.current),hiddenDays,offset);if((null==params?void 0:params.ignoreLimit)||isDateInAllowedRange(followingDate,minDate,maxDate))return followingDate}),[hiddenDays,maxDate,minDate]),getYByDate=useCallback(((date,compareDate)=>{const diff=differenceInMinutes(compareDate||date,addMinutes(startOfDay(date),timeFrom)),ptc=timeWeight*diff;return{ptc:ptc,px:timeUnit*ptc*((null==scaleRef?void 0:scaleRef.current)||1)}}),[timeFrom,timeUnit,timeWeight]),toDatetime=useCallback(((toDate,params)=>__awaiter(void 0,0,void 0,(function*(){toDate=tzDate(toDate,timezone);const containers=getActiveContainers(),collections=(null==collection?void 0:collection.items)||[BASE_COLLECTION],collectionIndex=void 0!==(null==params?void 0:params.collectionId)?collections.findIndex((({id:id})=>id===(null==params?void 0:params.collectionId))):0;if(-1===collectionIndex)throw new Error("Unknown collection id");const targetCollectionId=collections[collectionIndex].id,targetDate=(rtl?containers.slice().reverse():containers).filter((({collections:collections})=>collections.includes(targetCollectionId))).flatMap((({dates:dates})=>dates)).find((({date:date,collectionId:collectionId})=>collectionId===targetCollectionId&&isSameDay(date,toDate)));if(targetDate){const offset=snappable?targetDate.offset:Math.floor(targetDate.offset);setSelectedDate(targetDate.date),setContainersOffset(offset,!0),yield scrollXTo({value:100*-offset,animated:null==params?void 0:params.animated})}else{const adjustedDate=startOfDay(toDate),adjustedSelectedDate=startOfDay(selectedDateRef.current);yield reset({date:adjustedDate,animated:null==params?void 0:params.animated,ignoreLimit:!0,collectionIndex:collectionIndex,offset:rtl&&isAfter(adjustedSelectedDate,adjustedDate)||!rtl&&!isAfter(adjustedSelectedDate,adjustedDate)?1:-1})}(null==params?void 0:params.ignoreTime)||scrollYTo({value:getYByDate(toDate).px-scrollYMeasureRef.current.height/2,animated:null==params?void 0:params.animated})}))),[timezone,reset,rtl,setSelectedDate,snappable,null==collection?void 0:collection.items,getActiveContainers,getYByDate,scrollXTo,scrollYTo,setContainersOffset]),toSubOffset=useCallback(((offset,params)=>__awaiter(void 0,0,void 0,(function*(){if(scrolling$.value)return;const container=containersRef.current.get(Math.floor(containersOffsetRef.current.active)+offset*(rtl?-1:1));if(!container)return;if(!(null==params?void 0:params.ignoreLimit)){if(1===offset&&maxDate&&!container.dates.some((({date:date})=>isDateSatisfyMaxDate(date,maxDate))))return;if(-1===offset&&minDate&&!container.dates.some((({date:date})=>isDateSatisfyMinDate(date,minDate))))return}const adjustedOffset=(container.offset+containersOffsetRef.current.active%1*(containersOffsetRef.current.active>0?1:-1)).toFixed(3),targetDate=container.dates.find((date=>date.offset.toFixed(3)===adjustedOffset));targetDate&&(setContainersOffset(targetDate.offset),yield scrollXTo({value:100*-targetDate.offset,animated:null==params?void 0:params.animated}))}))),[maxDate,minDate,rtl,setContainersOffset,scrollXTo]),toOffsetDate=useCallback(((offset,params)=>__awaiter(void 0,0,void 0,(function*(){if(scrolling$.value)return;const collections=(null==collection?void 0:collection.items)||[BASE_COLLECTION],collectionIndex=void 0!==(null==params?void 0:params.collectionId)?collections.findIndex((({id:id})=>id===(null==params?void 0:params.collectionId))):0;if(-1===collectionIndex)throw new Error("Unknown collection id");const targetCollectionId=collections[collectionIndex].id,adjustedSide=offset*(rtl?-1:1),adjustedOffset=Math.floor(containersOffsetRef.current.active),adjustedSelectedDate=startOfDay(selectedDateRef.current),targetDate=Array.from(containersRef.current.keys()).sort(1===adjustedSide?(a,b)=>a-b:(a,b)=>b-a).filter(1===adjustedSide?offset=>offset>=adjustedOffset:offset=>offset<=adjustedOffset).flatMap((offset=>{var _a;const dates=null===(_a=containersRef.current.get(offset))||void 0===_a?void 0:_a.dates;return 1===adjustedSide?dates:dates.slice().reverse()})).find(1===offset?({date:date,collectionId:collectionId})=>collectionId===targetCollectionId&&isAfter(date,adjustedSelectedDate)&&((null==params?void 0:params.ignoreLimit)||isDateInAllowedRange(date,minDate,maxDate)):({date:date,collectionId:collectionId})=>collectionId===targetCollectionId&&isBefore(date,adjustedSelectedDate)&&((null==params?void 0:params.ignoreLimit)||isDateInAllowedRange(date,minDate,maxDate)));if(targetDate){const dateAdjustedOffset=!snappable||groupable?Math.floor(targetDate.offset):targetDate.offset;setSelectedDate(targetDate.date),setContainersOffset(dateAdjustedOffset,!0),yield scrollXTo({value:100*-dateAdjustedOffset,animated:null==params?void 0:params.animated})}else{const followingDate=getOffsetDate(offset,params);followingDate&&(yield reset({collectionIndex:collectionIndex,date:followingDate,offset:adjustedSide,animated:null==params?void 0:params.animated,ignoreLimit:null==params?void 0:params.ignoreLimit}))}}))),[getOffsetDate,groupable,maxDate,minDate,rtl,snappable,reset,null==collection?void 0:collection.items,setSelectedDate,setContainersOffset,scrollXTo]),getDatetimeFromPressEvent=useCallback((e=>{const scrollOffsetX=-adjustedScrollX$.value+containerWeight*(e.nativeEvent.pageX-scrollYMeasureRef.current.x-timelineLeftWidth),targetContainerDate=getActiveContainersDates().find((({offset:offset})=>{const offsetX=100*offset;return scrollOffsetX>=offsetX&&scrollOffsetX<offsetX+columnWidth}));if(!targetContainerDate)return;const scale=(null==scaleRef?void 0:scaleRef.current)||1,zonedDate=addMinutes(targetContainerDate.date,(scrollY$.value+e.nativeEvent.pageY+timeFrom*scale-scrollYMeasureRef.current.y-gridVerticalPadding)/scale);return Object.assign({tzDate:zonedDate,date:fromTzDate(zonedDate,timezone)},targetContainerDate.collectionId&&{collectionId:targetContainerDate.collectionId})}),[timezone,containerWeight,rtl,timelineLeftWidth,timeFrom,gridVerticalPadding,columnWidth,groupable,getActiveContainersDates]),onDatePress=useCallback(((e,hapticAction,callback)=>{var _a;if(!callback||scrolling$.value)return;const datetime=getDatetimeFromPressEvent(e);datetime&&(callback(datetime),null===(_a=null==haptic?void 0:haptic.emitImpact)||void 0===_a||_a.call(haptic,hapticAction))}),[null==haptic?void 0:haptic.emitImpact,getDatetimeFromPressEvent]),createEvent=useCallback((params=>__awaiter(void 0,0,void 0,(function*(){var _a;const getTargetDate=()=>getActiveContainersDates().find((({date:date,collectionId:collectionId})=>isSameDay(date,params.date)&&(!params.collectionId||params.collectionId===collectionId)));let targetDate=getTargetDate();if(targetDate||(yield toDatetime(params.date,{animated:!0,ignoreTime:!0,collectionId:params.collectionId}),targetDate=getTargetDate()),!targetDate)throw new Error(`Invalid params: "${params}"`);const date=tzDate(params.date,timezone),start=set(date,{minutes:Math.floor(date.getMinutes()/timeStep)*timeStep}),end=addMinutes(start,createEventDuration),countDays=differenceInCalendarDays(subMinutes(end,1),start);setDraggableEvent(Object.assign(Object.assign({},params),{start:start,end:end,offset:targetDate.offset,uiStart:start,duration:createEventDuration,isAllDay:createEventDuration>=1439,countDays:countDays})),null===(_a=null==haptic?void 0:haptic.emitImpact)||void 0===_a||_a.call(haptic,"onCreateEvent")}))),[toDatetime,getActiveContainersDates,timezone,timeStep,createEventDuration,setDraggableEvent,null==haptic?void 0:haptic.emitImpact]);return jsx(Context$4.Provider,{value:{reset:reset,getOffsetDate:getOffsetDate,getYByDate:getYByDate,toDatetime:toDatetime,toSubOffset:toSubOffset,toOffsetDate:toOffsetDate,getDatetimeFromPressEvent:getDatetimeFromPressEvent,onDatePress:onDatePress,createEvent:createEvent},children:children})},useOperation=()=>useContext(Context$4),Context$3=createContext(void 0),usePinch=()=>useContext(Context$3),Context$2=createContext(void 0),minCheckVelocity=isWeb?3e3:500,PanProvider=({children:children,swipeable:swipeable})=>{const{numberOfDays:numberOfDays}=useDatetime(),{rtl:rtl,snappable:snappable,groupable:groupable}=useController(),{containerWeight:containerWeight}=useDimension(),{scrollY$:scrollY$,scrollX$:scrollX$,setScrollableY:setScrollableY,scrollYTo:scrollYTo}=useScroll(),{containersOffsetRef:containersOffsetRef,moveContainers:moveContainers}=useContainer(),{draggableEvent:draggableEvent}=useEvent(),collection=useCollection(),pinch=usePinch(),panGestureRef=useRef(void 0),scrollXRef=useRef(0),panAxisRef=useRef(void 0),panning$=useSharedValue(!1),panX$=useSharedValue(0),panY$=useSharedValue(0),panWeight=useMemo((()=>groupable?(null==collection?void 0:collection.numberOfCollections)||1:numberOfDays),[null==collection?void 0:collection.numberOfCollections,groupable,numberOfDays]),adjustScrollXPosition=useCallback((e=>{const distance=containerWeight*e.translationX;let moveOffset=0;if(snappable){const scrollXOffset=panWeight/100*-distance;Math.abs(scrollXOffset)%1>.25&&(moveOffset=scrollXOffset>0?Math.ceil(scrollXOffset):Math.floor(scrollXOffset));const absVelocity=Math.abs(e.velocityX),changeByVelocity=Math.ceil(absVelocity/minCheckVelocity)-1,tOffset=e.translationX<0?1:-1;moveOffset=Math.min(panWeight,Math.max(changeByVelocity,Math.abs(moveOffset)))*tOffset}else distance<-10||e.velocityX<-minCheckVelocity?moveOffset=1:(distance>10||e.velocityX>minCheckVelocity)&&(moveOffset=-1);moveContainers(moveOffset,e.velocityX/10),panAxisRef.current=void 0,scrollXRef.current=0}),[containerWeight,snappable,moveContainers,panWeight]),panGesture=Gesture.Pan().onBegin((e=>{panning$.value=!0,panX$.value=e.x,panY$.value=e.y})).onStart((e=>{var _a;if(panX$.value=e.x,panY$.value=e.y,swipeable&&!draggableEvent&&!(null===(_a=null==pinch?void 0:pinch.pinch$)||void 0===_a?void 0:_a.value)){const axis=isWeb&&!(navigator.maxTouchPoints>0)||Math.abs(e.velocityX)>Math.abs(e.velocityY)?"x":"y";panAxisRef.current=axis,"x"===axis&&(runOnJS(setScrollableY)(!1),runOnJS(scrollYTo)({value:scrollY$.value}),cancelAnimation(scrollX$))}})).onChange((e=>{if(1===e.numberOfPointers)if(panX$.value=e.x,panY$.value=e.y,draggableEvent)scrollXRef.current&&runOnJS(adjustScrollXPosition)(e);else if("x"===panAxisRef.current){const adjustedScrollX=(props=>{const minScrollX=100*-props.containersOffsets.min,maxScrollX=100*-props.containersOffsets.max;return props.translationX>0&&props.scrollX>minScrollX?minScrollX:props.translationX<0&&props.scrollX<maxScrollX?maxScrollX:props.scrollX})({scrollX:scrollX$.value+e.changeX*containerWeight,translationX:e.translationX,containersOffsets:containersOffsetRef.current});scrollXRef.current=adjustedScrollX,scrollX$.value=adjustedScrollX}})).onFinalize((e=>{var _a;panning$.value=!1,"x"===panAxisRef.current&&scrollXRef.current&&!(null===(_a=null==pinch?void 0:pinch.pinch$)||void 0===_a?void 0:_a.value)&&(runOnJS(adjustScrollXPosition)(e),runOnJS(scrollYTo)({value:scrollY$.value})),runOnJS(setScrollableY)(!0)})).minDistance(1).withRef(panGestureRef).runOnJS(!0);return jsx(Context$2.Provider,{value:{panning$:panning$,panX$:panX$,panY$:panY$,panGesture:panGesture,panGestureRef:panGestureRef},children:children})},usePan=()=>useContext(Context$2),Context$1=createContext(void 0),SchemeColors={light:{background:"#FFFFFF",background1:"#F1F1F1",event:"#d8e4f1",text:"#000000",highlighted:"#FF6F61",white:"#FFFFFF",gray1:"#E0E0E0",gray2:"#CCCCCC",gray3:"#A9A9A9",gray4:"#666666",gray5:"#404040"},dark:{background:"#000000",background1:"#303030",highlighted:"#FF6F61",event:"#475867",text:"#FFFFFF",white:"#FFFFFF",gray1:"#E0E0E0",gray2:"#CCCCCC",gray3:"#A9A9A9",gray4:"#666666",gray5:"#404040"}},Context=createContext(void 0),ThemeProvider=props=>{const[systemScheme,setSystemScheme]=useState(Appearance.getColorScheme()),theme=useMemo((()=>{var _a;return((scheme,theme)=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x;const colors=SchemeColors[scheme];return{backgroundColor:(null===(_a=null==theme?void 0:theme[scheme])||void 0===_a?void 0:_a.backgroundColor)||theme.backgroundColor||colors.background,dayHeaderBackgroundColor:(null===(_b=null==theme?void 0:theme[scheme])||void 0===_b?void 0:_b.dayHeaderBackgroundColor)||theme.dayHeaderBackgroundColor||colors.background,dayHeaderTextColor:(null===(_c=null==theme?void 0:theme[scheme])||void 0===_c?void 0:_c.dayHeaderTextColor)||theme.dayHeaderTextColor||colors.text,headerSafeAreaBackgroundColor:(null===(_d=null==theme?void 0:theme[scheme])||void 0===_d?void 0:_d.headerSafeAreaBackgroundColor)||theme.headerSafeAreaBackgroundColor||colors.background,allDayEventsSafeAreaBackgroundColor:(null===(_e=null==theme?void 0:theme[scheme])||void 0===_e?void 0:_e.allDayEventsSafeAreaBackgroundColor)||theme.allDayEventsSafeAreaBackgroundColor||colors.background,allDayEventsSafeAreaTextColor:(null===(_f=null==theme?void 0:theme[scheme])||void 0===_f?void 0:_f.allDayEventsSafeAreaTextColor)||theme.allDayEventsSafeAreaTextColor||colors.text,timelineBackgroundColor:(null===(_g=null==theme?void 0:theme[scheme])||void 0===_g?void 0:_g.timelineBackgroundColor)||theme.timelineBackgroundColor||colors.background,timelineTextColor:(null===(_h=null==theme?void 0:theme[scheme])||void 0===_h?void 0:_h.timelineTextColor)||theme.timelineTextColor||colors.gray3,verticalLineColor:(null===(_j=null==theme?void 0:theme[scheme])||void 0===_j?void 0:_j.verticalLineColor)||theme.verticalLineColor||colors.background1,horizontalLineColor:(null===(_k=null==theme?void 0:theme[scheme])||void 0===_k?void 0:_k.horizontalLineColor)||theme.horizontalLineColor||colors.background1,nowIndicatorColor:(null===(_l=null==theme?void 0:theme[scheme])||void 0===_l?void 0:_l.nowIndicatorColor)||theme.nowIndicatorColor||colors.highlighted,unavailableTimeBackgroundColor:(null===(_m=null==theme?void 0:theme[scheme])||void 0===_m?void 0:_m.unavailableTimeBackgroundColor)||theme.unavailableTimeBackgroundColor||`${colors.background1}70`,dropZoneBackgroundColor:(null===(_o=null==theme?void 0:theme[scheme])||void 0===_o?void 0:_o.dropZoneBackgroundColor)||theme.dropZoneBackgroundColor||"transparent",eventBackgroundColor:(null===(_p=null==theme?void 0:theme[scheme])||void 0===_p?void 0:_p.eventBackgroundColor)||theme.eventBackgroundColor||colors.event,eventTextColor:(null===(_q=null==theme?void 0:theme[scheme])||void 0===_q?void 0:_q.eventTextColor)||theme.eventTextColor||colors.text,eventBorderColor:(null===(_r=null==theme?void 0:theme[scheme])||void 0===_r?void 0:_r.eventBorderColor)||theme.eventBorderColor||colors.background,collectionHeaderBackgroundColor:(null===(_s=null==theme?void 0:theme[scheme])||void 0===_s?void 0:_s.collectionHeaderBackgroundColor)||theme.collectionHeaderBackgroundColor||colors.background,collectionHeaderTextColor:(null===(_t=null==theme?void 0:theme[scheme])||void 0===_t?void 0:_t.collectionHeaderTextColor)||theme.collectionHeaderTextColor||colors.text,progressBarColor:5===(null===(_v=null===(_u=null==theme?void 0:theme[scheme])||void 0===_u?void 0:_u.progressBarColor)||void 0===_v?void 0:_v.length)?null===(_w=null==theme?void 0:theme[scheme])||void 0===_w?void 0:_w.progressBarColor:5===(null===(_x=theme.progressBarColor)||void 0===_x?void 0:_x.length)?theme.progressBarColor:[colors.gray1,colors.gray2,colors.gray3,colors.gray4,colors.gray5]}})((null===(_a=props.theme)||void 0===_a?void 0:_a.scheme)||systemScheme||"light",props.theme||{})}),[props.theme,systemScheme]);return useEffect((()=>{const listener=Appearance.addChangeListener((({colorScheme:colorScheme})=>setSystemScheme(colorScheme)));return()=>listener.remove()}),[]),jsx(Context.Provider,{value:theme,children:props.children})},useTheme=()=>useContext(Context),EventText=memo((({rtl:rtl,event:event,duration:duration,color:color})=>{var _a;const size=Math.min(Math.max(8,duration/3),14);return jsx(Text,{style:[styles$j.text,Object.assign(Object.assign({padding:duration>15?5:2,color:event.textColor||(null===(_a=event.origin)||void 0===_a?void 0:_a.textColor)||color,fontSize:size,lineHeight:size},rtl&&{textAlign:"right"}),{overflow:"hidden"})],children:event.text})}),((prevProps,nextProps)=>objectsEqual(prevProps,nextProps))),styles$j=StyleSheet.create({text:{top:0,position:"sticky"}}),AllDayEvents=memo((({scrolling$:scrolling$,rtl:rtl,max:max,height:height,top:top,events:events,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,eColor:eColor,eHeight:eHeight,eWidth:eWidth,eWidthUnit:eWidthUnit,eVOffset:eVOffset,eBgColor:eBgColor,eBrColor:eBrColor,eBrRadius:eBrRadius,eBrWidth:eBrWidth,render:render,EventItem:EventItem,onEventPress:onEventPress,onEventLongPress:onEventLongPress,emitImpact:emitImpact})=>jsx(View,{style:[styles$i.container,{borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,top:top,height:height}],children:!!events.length&&events.filter((({row:row})=>row<max)).map((event=>jsx(Event$1,{scrolling$:scrolling$,event:event,rtl:rtl,eColor:eColor,eHeight:eHeight,eWidth:eWidth,eWidthUnit:eWidthUnit,eVOffset:eVOffset,eBgColor:eBgColor,eBrColor:eBrColor,eBrRadius:eBrRadius,eBrWidth:eBrWidth,render:render,EventItem:EventItem,onEventPress:onEventPress,onEventLongPress:onEventLongPress,emitImpact:emitImpact},`${event.key}_${event.offset}`)))}))),Event$1=memo((({scrolling$:scrolling$,rtl:rtl,event:event,EventItem:EventItem,eColor:eColor,eBgColor:eBgColor,eBrWidth:eBrWidth,eBrRadius:eBrRadius,eBrColor:eBrColor,eHeight:eHeight,eWidth:eWidth,eWidthUnit:eWidthUnit,eVOffset:eVOffset,render:render,onEventPress:onEventPress,onEventLongPress:onEventLongPress,emitImpact:emitImpact})=>{const pressable=onEventPress||onEventLongPress,onLongPress=useCallback((()=>{onEventLongPress&&!scrolling$.value&&(onEventLongPress({event:event.origin}),null==emitImpact||emitImpact("onEventLongPress"))}),[emitImpact,onEventLongPress,event.origin]),onPress=useCallback((()=>{onEventPress&&!scrolling$.value&&(onEventPress({event:event.origin}),null==emitImpact||emitImpact("onEventPress"))}),[emitImpact,onEventPress,event.origin]);return jsx(Pressable,{style:({pressed:pressed})=>[styles$i.event,Object.assign({top:1+event.row*eHeight,left:event.column*eWidth+"%",width:eWidth*event.numOfColumns+"%",height:eHeight,cursor:pressable?"pointer":"auto",borderColor:eBrColor,borderRadius:eBrRadius,borderWidth:eBrWidth,backgroundColor:event.origin.backgroundColor||eBgColor},!render&&Object.assign({opacity:pressable&&pressed?.9:1,width:eWidthUnit*eWidth*event.numOfColumns-eVOffset},rtl?{marginRight:eVOffset}:{marginLeft:eVOffset}))],onPress:onPress,onLongPress:onLongPress,children:jsx(EventItem,{event:event,rtl:rtl,eColor:eColor,eHeight:eHeight,render:render})})})),AllDayEventItem=memo((({event:event,eColor:eColor,eHeight:eHeight,rtl:rtl})=>jsx(EventText,{event:event,duration:eHeight,rtl:rtl,color:eColor})));memo((props=>{var _a;return(null===(_a=props.render)||void 0===_a?void 0:_a.call(props,{event:props.event.origin}))||jsx(AllDayEventItem,Object.assign({},props))}));const styles$i=StyleSheet.create({container:{position:"absolute",width:"100%"},event:{position:"absolute",overflow:"hidden"}}),AllDayEventsSafeArea=memo((({color:color,text:text,backgroundColor:backgroundColor,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,height:height,SafeArea:SafeArea,emitImpact:emitImpact,onPress:onPress,render:render})=>{const press=useCallback((()=>{null==onPress||onPress(),null==emitImpact||emitImpact("onAllDayEventsSafeAreaPress")}),[emitImpact,onPress]);return jsx(Pressable,{disabled:!onPress,style:[styles$h.view,!render&&styles$h.cView,{height:height,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,backgroundColor:backgroundColor}],onPress:press,children:jsx(SafeArea,{text:text,color:color,render:render})})})),EventsSafeAreaContent=memo((({text:text,color:color})=>jsx(Text,{style:[styles$h.text,{color:color}],children:text})));memo((({render:render,color:color,text:text})=>(null==render?void 0:render())||jsx(EventsSafeAreaContent,{color:color,text:text})));const styles$h=StyleSheet.create({view:{width:"100%",overflow:"hidden"},cView:{justifyContent:"center",alignItems:"center",padding:2},text:{fontSize:12}}),BodyController=({contentOpacity$:contentOpacity$,children:children,selectedDateRef:selectedDateRef,gesture:gesture,paddingTop:paddingTop,timegridRef:timegridRef})=>{const{backgroundColor:backgroundColor}=useTheme(),{timegridWidth:timegridWidth}=useDimension(),{toSubOffset:toSubOffset,getOffsetDate:getOffsetDate,toDatetime:toDatetime,toOffsetDate:toOffsetDate,reset:reset,createEvent:createEvent}=useOperation(),{weekStartsOn:weekStartsOn,timeFrom:timeFrom,timeTo:timeTo,timezone:timezone,numberOfDays:numberOfDays,minDate:minDate,maxDate:maxDate,hiddenDays:hiddenDays}=useDatetime(),{groupable:groupable,rtl:rtl,snappable:snappable}=useController(),collection=useCollection(),sensitiveRef=useRef({weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,numberOfDays:numberOfDays,minDate:minDate,maxDate:maxDate,rtl:rtl,groupable:groupable,snappable:snappable,timezone:timezone,timeFrom:timeFrom,timeTo:timeTo,numberOfCollections:null==collection?void 0:collection.numberOfCollections,collections:null==collection?void 0:collection.items}),onContextMenu=useCallback((e=>e.preventDefault()),[]);return useImperativeHandle(timegridRef,(()=>({getPrevDate:params=>getOffsetDate(-1,params),getNextDate:params=>getOffsetDate(1,params),prevDate:params=>{toOffsetDate(-1,params)},nextDate:params=>{toOffsetDate(1,params)},back:params=>{toSubOffset(-1,params)},forward:params=>{toSubOffset(1,params)},toDatetime:(date,params)=>{toDatetime(date,params)},createEvent:params=>{createEvent(params)}})),[createEvent,getOffsetDate,toDatetime,toOffsetDate,toSubOffset]),useEffect((()=>{var _a,_b,_c;const ref=sensitiveRef.current;if(!ref)return;const shouldReset=ref.groupable!==groupable||ref.rtl!==rtl||ref.snappable!==snappable||ref.weekStartsOn!==weekStartsOn||ref.numberOfDays!==numberOfDays||ref.timeFrom!==timeFrom||ref.timeTo!==timeTo||ref.timezone!==timezone||ref.numberOfCollections!==(null==collection?void 0:collection.numberOfCollections)||!isSameDay(ref.minDate||0,minDate||0)||!isSameDay(ref.maxDate||0,maxDate||0)||(null===(_a=ref.hiddenDays)||void 0===_a?void 0:_a.length)!==(null==hiddenDays?void 0:hiddenDays.length)||ref.hiddenDays&&!ref.hiddenDays.every((day=>null==hiddenDays?void 0:hiddenDays.includes(day)))||(null===(_b=ref.collections)||void 0===_b?void 0:_b.length)!==(null===(_c=null==collection?void 0:collection.items)||void 0===_c?void 0:_c.length)||!(!ref.collections||ref.collections.every((refCollection=>{var _a;return null===(_a=null==collection?void 0:collection.items)||void 0===_a?void 0:_a.some((collection=>refCollection.id===collection.id))})));shouldReset&&(sensitiveRef.current={weekStartsOn:weekStartsOn,hiddenDays:hiddenDays,numberOfDays:numberOfDays,minDate:minDate,maxDate:maxDate,rtl:rtl,groupable:groupable,snappable:snappable,timezone:timezone,timeFrom:timeFrom,timeTo:timeTo,numberOfCollections:null==collection?void 0:collection.numberOfCollections,collections:null==collection?void 0:collection.items},contentOpacity$.value=0,reset({date:selectedDateRef.current,collectionIndex:0,offset:0}),contentOpacity$.value=withTiming(1,{duration:200}))}),[groupable,hiddenDays,maxDate,minDate,numberOfDays,rtl,snappable,timeFrom,timeTo,timezone,weekStartsOn,collection,reset]),jsx(GestureHandlerRootView,{children:jsx(GestureDetector,{touchAction:"pan-x",gesture:gesture,children:jsx(View,{style:[styles$g.wrapper,{backgroundColor:backgroundColor,paddingTop:paddingTop,width:timegridWidth}],onContextMenu:onContextMenu,children:children})})},"symbiot-timegrid-gesture-root-view")},styles$g=StyleSheet.create({wrapper:{flex:1,overflow:"hidden",flexDirection:"row",position:"relative",width:"100%"}});memo((({scrolling$:scrolling$,id:id,name:name,rtl:rtl,height:height,vBorderWidth:vBorderWidth,vBorderColor:vBorderColor,backgroundColor:backgroundColor,color:color,emitImpact:emitImpact,render:render,onPress:onPress})=>{const press=useCallback((()=>{scrolling$.value||(null==onPress||onPress({collectionId:id}),null==emitImpact||emitImpact("onCollectionHeaderPress"))}),[emitImpact,onPress]);return jsx(Pressable,{disabled:!onPress,style:[styles$f.pressable,Object.assign({height:height,backgroundColor:backgroundColor},!render&&Object.assign({},rtl?{borderRightColor:vBorderColor,borderRightWidth:vBorderWidth}:{borderLeftColor:vBorderColor,borderLeftWidth:vBorderWidth}))],onPress:press,children:(null==render?void 0:render({collectionId:id}))||jsx(Text,{numberOfLines:1,style:{color:color},children:name})})}));const styles$f=StyleSheet.create({pressable:{flex:1,justifyContent:"center",alignItems:"center"}}),DayColumn=memo((({scrolling$:scrolling$,rtl:rtl,visible:visible,date:date,index:index,collectionId:collectionId,Header:Header,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,backgroundColor:backgroundColor,vBorderColor:vBorderColor,vBorderWidth:vBorderWidth,render:render,top:top,width:width,height:height,format:format,color:color,formatDate:formatDate,emitImpact:emitImpact,onPress:onPress})=>{const press=useCallback((()=>{scrolling$.value||(null==onPress||onPress(Object.assign({date:date,tzDate:date},collectionId&&{collectionId:collectionId})),null==emitImpact||emitImpact("onDayHeaderPress"))}),[emitImpact,onPress,date,collectionId]);return jsx(View,{style:[styles$e.column,Object.assign({top:top,left:width*index+"%",width:`${width}%`},rtl?{borderRightColor:vBorderColor,borderRightWidth:vBorderWidth}:{borderLeftColor:vBorderColor,borderLeftWidth:vBorderWidth})],children:visible&&jsx(Pressable,{style:[styles$e.pressable,Object.assign({backgroundColor:backgroundColor,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,height:height,marginTop:-height},!render&&{borderLeftColor:vBorderColor,borderLeftWidth:vBorderWidth,marginLeft:-vBorderWidth})],disabled:!onPress,onPress:press,children:jsx(Header,{date:date,render:render,format:format,color:color,formatDate:formatDate})})})})),DayHeader=memo((({date:date,color:color,formatDate:formatDate,format:format})=>jsx(Text,{style:[styles$e.day,{color:color}],children:formatDate(date,format)})));memo((props=>{var _a;return(null===(_a=props.render)||void 0===_a?void 0:_a.call(props,{date:props.date}))||jsx(DayHeader,Object.assign({},props))}));const styles$e=StyleSheet.create({column:{position:"absolute",bottom:0},pressable:{justifyContent:"center",alignItems:"center",flexDirection:"row"},day:{textAlign:"center",marginTop:2}}),Columns=({container:container,allDayEventsHeight:allDayEventsHeight})=>{const{dayHeaderTextFormat:dayHeaderTextFormat,numberOfDays:numberOfDays,formatDate:formatDate}=useDatetime(),{adjustedScrollX$:adjustedScrollX$,scrolling$:scrolling$}=useScroll(),{dayHeaderBackgroundColor:dayHeaderBackgroundColor,verticalLineColor:verticalLineColor,horizontalLineColor:horizontalLineColor,dayHeaderTextColor:dayHeaderTextColor,eventTextColor:eventTextColor,eventBackgroundColor:eventBackgroundColor,eventBorderColor:eventBorderColor}=useTheme(),{containerRight:containerRight,containerLeft:containerLeft,containerWidth:containerWidth,containerUnit:containerUnit,headerHeight:headerHeight,columnWidth:columnWidth,dayHeaderHeight:dayHeaderHeight,verticalLineSize:verticalLineSize,horizontalLineSize:horizontalLineSize,allDayEventHeight:allDayEventHeight,eventBorderWidth:eventBorderWidth,eventBorderRadius:eventBorderRadius}=useDimension(),{rtl:rtl,snappable:snappable,isDayHeaderVisible:isDayHeaderVisible,isAllDayEventsEnabled:isAllDayEventsEnabled}=useController(),{onDayHeaderPress:onDayHeaderPress,onEventPress:onEventPress,onEventLongPress:onEventLongPress}=useAction(),{activeAllDayEvents:activeAllDayEvents,maxAllDayEventsByOffset:maxAllDayEventsByOffset}=useEvent(),activeAllDayEventsRef=useRef([]),eventsRef=useRef([]),events=useMemo((()=>{const datesOffsets=container.dates.map((({offset:offset})=>offset)),containerEvents=activeAllDayEvents.filter((event=>datesOffsets.includes(event.offset)));if(!arraysOfObjectsEqual(activeAllDayEventsRef.current,activeAllDayEvents)&&(containerEvents.length||activeAllDayEventsRef.current.length)){activeAllDayEventsRef.current=containerEvents;const arrangedEvents=((events,params)=>{if(!events.length)return[];const columnsByOffset=params.dates.reduce(((obj,{offset:offset},index)=>Object.assign(Object.assign({},obj),{[offset]:index})),{}),grid={},arrangedEvents=events.reduce(((events,event)=>{const targetEvent=events.find((({origin:origin,column:column,numOfColumns:numOfColumns})=>origin.id===event.origin.id&&columnsByOffset[event.offset]===column+numOfColumns));return params.single||!targetEvent||targetEvent.numOfColumns===params.columns?events.push(Object.assign(Object.assign({},event),{column:columnsByOffset[event.offset],numOfColumns:1,row:0})):targetEvent.numOfColumns=Math.min(targetEvent.numOfColumns+1,params.columns),events}),[]);return arrangedEvents.sort(((a,b)=>b.numOfColumns-a.numOfColumns)).forEach((event=>{var _a;let row=0;for(;;){const cols=Array.from({length:event.numOfColumns}).map(((_,index)=>event.column+index));if(!(null===(_a=grid[row])||void 0===_a?void 0:_a.some((col=>cols.includes(col))))){grid[row]=[...grid[row]||[],...cols];break}row++}event.row=row})),arrangedEvents})(containerEvents,{single:snappable,dates:container.dates,columns:numberOfDays});eventsRef.current=arrangedEvents.map((event=>eventsRef.current.find((refEvent=>objectsEqual(refEvent,event)))||event))}return eventsRef.current}),[activeAllDayEvents,container.dates,numberOfDays,snappable]),animatedStyle=useAnimatedStyle((()=>({transform:[{translateX:(100*container.offset+adjustedScrollX$.value)*containerUnit}]})),[containerUnit]);return jsxs(Animated.View,{style:[styles$d.view,animatedStyle,{left:containerLeft,right:containerRight,width:containerWidth}],children:[container.dates.map(((date,index)=>createElement(DayColumn,Object.assign({},date,{scrolling$:scrolling$,key:`${date.offset}_${date.collectionId}_${index}`,index:index,rtl:rtl,visible:isDayHeaderVisible,format:dayHeaderTextFormat,color:dayHeaderTextColor,vBorderColor:verticalLineColor,vBorderWidth:verticalLineSize,borderBottomColor:horizontalLineColor,borderBottomWidth:horizontalLineSize,backgroundColor:dayHeaderBackgroundColor,top:headerHeight,width:columnWidth,height:dayHeaderHeight,formatDate:formatDate,Header:DayHeader,onPress:onDayHeaderPress})))),isAllDayEventsEnabled&&jsx(AllDayEvents,{scrolling$:scrolling$,height:allDayEventsHeight||0,top:headerHeight,max:maxAllDayEventsByOffset,events:events,borderBottomColor:horizontalLineColor,borderBottomWidth:horizontalLineSize,EventItem:AllDayEventItem,rtl:rtl,eHeight:allDayEventHeight,eWidth:columnWidth,eWidthUnit:containerUnit,eVOffset:verticalLineSize,eColor:eventTextColor,eBgColor:eventBackgroundColor,eBrColor:eventBorderColor,eBrWidth:eventBorderWidth,eBrRadius:eventBorderRadius,onEventPress:onEventPress,onEventLongPress:onEventLongPress})]})},styles$d=StyleSheet.create({view:{position:"absolute",flexDirection:"row",top:0,bottom:0,zIndex:1}}),NowIndicatorLine=memo((({rtl:rtl,backgroundColor:backgroundColor,height:height,top:top,sideMargin:sideMargin,width:width,left:left,Line:Line})=>jsx(View,{style:[styles$c.indicator,Object.assign({top:top,width:width,left:left},!Line&&Object.assign({height:height,backgroundColor:backgroundColor},rtl?{marginRight:sideMargin}:{marginLeft:sideMargin}))],children:!!Line&&jsx(Line,{})}))),styles$c=StyleSheet.create({indicator:{position:"absolute",zIndex:5,pointerEvents:"none"}}),Events=memo((({scrolling$:scrolling$,columnWidth:columnWidth,columnUnit:columnUnit,containerUnit:containerUnit,verticalLineSize:verticalLineSize,color:color,borderColor:borderColor,borderWidth:borderWidth,borderRadius:borderRadius,backgroundColor:backgroundColor,rtl:rtl,draggable:draggable,timeWeight:timeWeight,timezone:timezone,events:events,draggableEvent:draggableEvent,setDraggableEvent:setDraggableEvent,render:render,emitImpact:emitImpact,EventContent:EventContent,onEventPress:onEventPress,onEventLongPress:onEventLongPress})=>events.map((({event:event,top:top,left:left,column:column,width:width})=>{var _a;return jsx(Event,{scrolling$:scrolling$,event:event,width:render?columnUnit*width+"%":containerUnit*(columnUnit*width)-verticalLineSize,left:columnUnit*left+column*columnWidth+"%",top:`${top}%`,rtl:rtl,marginLeft:rtl?void 0:verticalLineSize,draggable:draggable,dragging:(null===(_a=null==draggableEvent?void 0:draggableEvent.origin)||void 0===_a?void 0:_a.id)===event.origin.id,timeWeight:timeWeight,timezone:timezone,backgroundColor:backgroundColor,borderColor:borderColor,borderWidth:borderWidth,borderRadius:borderRadius,color:color,height:event.uiDuration,setDraggableEvent:setDraggableEvent,EventContent:EventContent,render:render,emitImpact:emitImpact,onEventPress:onEventPress,onEventLongPress:onEventLongPress},`${event.key}_${event.offset}`)})))),Event=memo((({scrolling$:scrolling$,event:event,rtl:rtl,timezone:timezone,timeWeight:timeWeight,draggable:draggable,dragging:dragging,height:height,color:color,borderColor:borderColor,borderWidth:borderWidth,borderRadius:borderRadius,backgroundColor:backgroundColor,width:width,top:top,left:left,marginLeft:marginLeft,render:render,EventContent:EventContent,emitImpact:emitImpact,onEventPress:onEventPress,onEventLongPress:onEventLongPress,setDraggableEvent:setDraggableEvent})=>{const pressable=onEventPress||onEventLongPress||draggable&&!event.origin.readonly,onPress=useCallback((()=>{onEventPress&&!scrolling$.value&&(onEventPress({event:event.origin}),null==emitImpact||emitImpact("onEventPress"))}),[emitImpact,onEventPress,event.origin]),onLongPress=useCallback((()=>{if(!scrolling$.value){if(draggable&&!event.origin.readonly){const start=tzDate(event.origin.start,timezone),end=tzDate(event.origin.end,timezone);setDraggableEvent(Object.assign(Object.assign({},event.origin),{start:start,end:end,offset:event.offset,uiStart:event.start,origin:event.origin,duration:event.duration,isAllDay:event.isAllDay,countDays:differenceInCalendarDays(subMinutes(end,1),start)}))}onEventLongPress&&(onEventLongPress({event:event.origin}),null==emitImpact||emitImpact("onEventLongPress"))}}),[emitImpact,onEventLongPress,event,draggable,timezone]);return jsx(Pressable,{style:({pressed:pressed})=>[styles$b.container,Object.assign({left:left,top:top,width:width,height:timeWeight*event.uiDuration+"%",cursor:pressable?"pointer":"auto",borderColor:borderColor,borderRadius:borderRadius,borderWidth:borderWidth,backgroundColor:event.origin.backgroundColor||backgroundColor},!render&&{marginLeft:marginLeft,opacity:pressable&&pressed||dragging?dragging?.5:.9:1})],onPress:onPress,onLongPress:onLongPress,children:jsx(EventContent,{event:event,rtl:rtl,height:height,color:color,render:render})})})),EventContent=memo((({event:event,color:color,height:height,rtl:rtl})=>jsx(EventText,{event:event,duration:height,rtl:rtl,color:color})));memo((props=>{var _a;return(null===(_a=props.render)||void 0===_a?void 0:_a.call(props,{event:props.event.origin}))||jsx(EventContent,Object.assign({},props))}));const styles$b=StyleSheet.create({container:{position:"absolute"}}),UnavailableTime=memo((({slots:slots,width:width,timeWeight:timeWeight,pressable:pressable,backgroundColor:backgroundColor,Time:Time,onPress:onPress,onLongPress:onLongPress})=>slots.map((slot=>jsx(Pressable,{style:[styles$a.slot,Object.assign({top:timeWeight*slot.from+"%",left:slot.columns.start*width+"%",height:timeWeight*(slot.to-slot.from)+"%",width:slot.columns.count*width+"%",cursor:pressable?"pointer":"auto"},!Time&&{backgroundColor:backgroundColor})],onPress:onPress,onLongPress:onLongPress,children:!!Time&&jsx(Time,{})},slot.key))))),styles$a=StyleSheet.create({slot:{position:"absolute",overflow:"hidden"}}),useRendered=props=>{const[rendered,setRendered]=useState(!1);return useEffect((()=>{setTimeout((()=>setRendered(!0)),void 0)}),[]),{rendered:rendered}},ContentElements=({container:container})=>{const{adjustedScrollX$:adjustedScrollX$,scrolling$:scrolling$}=useScroll(),{nowIndicatorColor:nowIndicatorColor,eventBackgroundColor:eventBackgroundColor,eventBorderColor:eventBorderColor,eventTextColor:eventTextColor,unavailableTimeBackgroundColor:unavailableTimeBackgroundColor}=useTheme(),{rtl:rtl,draggable:draggable,isNowIndicatorVisible:isNowIndicatorVisible,isAllDayEventsEnabled:isAllDayEventsEnabled,isAllDayEventsVisible:isAllDayEventsVisible}=useController(),{utByOffset:utByOffset}=useUt(),{now:now,timezone:timezone,timeWeight:timeWeight,isDateInRange:isDateInRange}=useDatetime(),{eventsByOffset:eventsByOffset,draggableEvent:draggableEvent,setDraggableEvent:setDraggableEvent}=useEvent(),{containerRight:containerRight,containerLeft:containerLeft,containerWidth:containerWidth,nowIndicatorHeight:nowIndicatorHeight,columnUnit:columnUnit,containerUnit:containerUnit,columnWidth:columnWidth,verticalLineSize:verticalLineSize,eventBorderWidth:eventBorderWidth,eventBorderRadius:eventBorderRadius}=useDimension(),{onEventPress:onEventPress,onEventLongPress:onEventLongPress,onUnavailableTimeLongPress:onUnavailableTimeLongPress,onUnavailableTimePress:onUnavailableTimePress}=useAction(),{getYByDate:getYByDate,onDatePress:onDatePress}=useOperation(),{rendered:rendered}=useRendered(),eventsByOffsetRef=useRef([]),eventsRef=useRef([]),utRef=useRef([]),[nowByDate,setNowByDate]=useState({}),animatedStyle=useAnimatedStyle((()=>({transform:[{translateX:(100*container.offset+adjustedScrollX$.value)*containerUnit}]})),[containerUnit]),events=useMemo((()=>{const containerEvents=eventsByOffset[container.offset];if(!containerEvents)return[];if(!arraysOfObjectsEqual(eventsByOffsetRef.current,containerEvents)&&(containerEvents.length||eventsByOffsetRef.current.length)){eventsByOffsetRef.current=containerEvents;const arrangedEvents=((events,props)=>{const filteredEvents=props.ignoreAllDayEvents?null==events?void 0:events.filter((({isAllDay:isAllDay})=>!isAllDay)):events;if(!(null==filteredEvents?void 0:filteredEvents.length))return[];const columnsByOffset=props.dates.reduce(((obj,{offset:offset},index)=>Object.assign(Object.assign({},obj),{[offset]:index})),{}),entities=filteredEvents.map((event=>({event:event,top:props.getYByDate(event.start).ptc,column:columnsByOffset[event.offset],width:0,left:0})));return entities.forEach((entity=>{if(entity.width)return;const overlappedEntities=entities.map(((overlappedEntity,originIndex)=>overlappedEntity.column===entity.column&&areIntervalsOverlapping(overlappedEntity.event,entity.event)?originIndex:void 0)).filter((index=>void 0!==index));if(1===overlappedEntities.length)entity.width=100;else{const widthWeight=100/overlappedEntities.length;overlappedEntities.filter((originIndex=>!entities[originIndex].width)).forEach(((originIndex,index)=>{const targetEvent=entities[originIndex],additionalWidth=index?5:0;targetEvent.left=widthWeight*index-index-additionalWidth,targetEvent.width=widthWeight+index+additionalWidth}))}})),entities.sort(((a,b)=>a.left-b.left))})(containerEvents,{ignoreAllDayEvents:isAllDayEventsEnabled||!isAllDayEventsVisible,dates:container.dates,getYByDate:getYByDate});eventsRef.current=arrangedEvents.map((event=>eventsRef.current.find((refEvent=>objectsEqual(refEvent,event)))||event))}return eventsRef.current}),[container.dates,container.offset,eventsByOffset,getYByDate,isAllDayEventsEnabled,isAllDayEventsVisible]),ut=useMemo((()=>{const containerUt=utByOffset[container.offset];return(null==containerUt?void 0:containerUt.length)?(arraysOfObjectsEqual(utRef.current,containerUt)||!containerUt.length&&!utRef.current.length||(utRef.current=containerUt.map((slot=>utRef.current.find((refSlot=>objectsEqual(refSlot,slot)))||slot))),utRef.current):[]}),[container.offset,utByOffset]),onUTPress=useCallback((e=>onDatePress(e,"onUnavailableTimePress",onUnavailableTimePress)),[onDatePress,onUnavailableTimePress]),onUTLongPress=useCallback((e=>onDatePress(e,"onUnavailableTimeLongPress",onUnavailableTimeLongPress)),[onDatePress,onUnavailableTimeLongPress]);return useLayoutEffect((()=>{const value={};container.dates.forEach((({date:date,offset:offset})=>{const top=getYByDate(date,now).ptc;isDateInRange(date)?value[offset]=top:value[offset]=void 0})),setNowByDate(value)}),[container.dates,now,getYByDate,isDateInRange]),jsxs(Animated.View,{style:[styles$9.view,animatedStyle,{left:containerLeft,right:containerRight,width:containerWidth}],children:[rendered&&!!ut.length&&jsx(UnavailableTime,{slots:ut,width:columnWidth,timeWeight:timeWeight,pressable:!!onUnavailableTimePress||!!onUnavailableTimeLongPress,backgroundColor:unavailableTimeBackgroundColor,onPress:onUTPress,onLongPress:onUTLongPress}),rendered&&!!events.length&&jsx(Events,{scrolling$:scrolling$,columnWidth:columnWidth,containerUnit:containerUnit,columnUnit:columnUnit,verticalLineSize:verticalLineSize,rtl:rtl,draggable:draggable,timezone:timezone,timeWeight:timeWeight,backgroundColor:eventBackgroundColor,borderColor:eventBorderColor,borderWidth:eventBorderWidth,borderRadius:eventBorderRadius,color:eventTextColor,events:events,draggableEvent:draggableEvent,setDraggableEvent:setDraggableEvent,EventContent:EventContent,onEventPress:onEventPress,onEventLongPress:onEventLongPress}),isNowIndicatorVisible&&container.dates.map((({collectionId:collectionId,offset:offset},index)=>void 0!==nowByDate[offset]&&jsx(NowIndicatorLine,{rtl:rtl,top:`${nowByDate[offset]}%`,sideMargin:verticalLineSize,backgroundColor:nowIndicatorColor,height:nowIndicatorHeight,left:index*columnWidth+"%",width:`${columnWidth}%`},`${container.offset}_${collectionId}_${offset}`)))]})},styles$9=StyleSheet.create({view:{position:"absolute",flexDirection:"row",top:0,bottom:0,zIndex:1}}),AnimatedPressable=Animated.createAnimatedComponent(Pressable),DragEvent=({event:event,width:width,height:height,x$:x$,y$:y$,onPressIn:onPressIn,EventContent:EventContent})=>{var _a;const{verticalLineSize:verticalLineSize,eventBorderWidth:eventBorderWidth,eventBorderRadius:eventBorderRadius}=useDimension(),{rtl:rtl}=useController(),{eventBorderColor:eventBorderColor,eventBackgroundColor:eventBackgroundColor}=useTheme(),render=useContext(Context$1),hasRenderMethod=useMemo((()=>event.origin&&(null==render?void 0:render.renderUpdateEvent)||event.origin&&(null==render?void 0:render.renderEvent)||!event.origin&&(null==render?void 0:render.renderCreateEvent)),[event.origin,null==render?void 0:render.renderCreateEvent,null==render?void 0:render.renderEvent,null==render?void 0:render.renderUpdateEvent]),animatedStyle=useAnimatedStyle((()=>({transform:[{translateY:y$.value},{translateX:x$.value}]})),[]);return jsx(AnimatedPressable,{style:[animatedStyle,styles$8.event,Object.assign({height:height,width:width,borderRadius:eventBorderRadius,borderWidth:eventBorderWidth,borderColor:eventBorderColor,backgroundColor:(null==event?void 0:event.backgroundColor)||(null===(_a=event.origin)||void 0===_a?void 0:_a.backgroundColor)||eventBackgroundColor},!hasRenderMethod&&{width:width-verticalLineSize,left:!rtl&&verticalLineSize})],onPressIn:onPressIn,children:jsx(EventContent,{event:event})})},EventDragContent=({event:event})=>{const{rtl:rtl}=useController(),{eventTextColor:eventTextColor}=useTheme();return jsx(EventText,{event:event,duration:event.duration,rtl:rtl,color:eventTextColor})},styles$8=StyleSheet.create({event:{overflow:"hidden",position:"absolute",zIndex:2,top:0}}),DragStickyEvent=({event:event,width:width,height:height,x$:x$,y$:y$,onPressIn:onPressIn,EventContent:EventContent})=>{const{eventBorderRadius:eventBorderRadius,eventBorderWidth:eventBorderWidth}=useDimension(),{eventBorderColor:eventBorderColor}=useTheme(),animatedStyle=useAnimatedStyle((()=>({transform:[{translateY:y$.value},{translateX:x$.value}]})),[]);return jsx(AnimatedPressable,{style:[styles$7.container,animatedStyle,{width:width,height:height}],onPressIn:onPressIn,children:!!EventContent&&jsx(EventContent,{event:event})})},styles$7=StyleSheet.create({container:{overflow:"hidden",position:"absolute",left:0,top:0}}),DragDropColumn=({x$:x$})=>{const{dropZoneBackgroundColor:dropZoneBackgroundColor}=useTheme(),{rtl:rtl}=useController(),{numberOfDays:numberOfDays}=useDatetime(),{containerWidth:containerWidth,verticalLineSize:verticalLineSize}=useDimension(),collection=useCollection(),width=useMemo((()=>containerWidth/((null==collection?void 0:collection.numberOfCollections)||1)/numberOfDays),[containerWidth,numberOfDays,null==collection?void 0:collection.numberOfCollections]),animatedStyle=useAnimatedStyle((()=>({transform:[{translateX:x$.value}]})),[]);return jsx(Animated.View,{style:[animatedStyle,styles$6.column,Object.assign({width:width,backgroundColor:dropZoneBackgroundColor},rtl?{left:-verticalLineSize}:{left:verticalLineSize})]})},styles$6=StyleSheet.create({column:{position:"absolute",height:"100%",top:0,left:0}}),autoscrollYDistance=isWeb?100:5,autoscrollYInterval=isWeb?100:10,autoscrollXInterval=isWeb?700:500,DragZoneController=({opacity$:opacity$,x$:x$,y$:y$,released$:released$,children:children,offsetTop:offsetTop,onPress:onPress})=>{const{moveContainers:moveContainers}=useContainer(),{scrollY$:scrollY$,scrollYMeasureRef:scrollYMeasureRef,scrollYTo:scrollYTo}=useScroll(),{timelineLeftWidth:timelineLeftWidth,containerUnit:containerUnit,containerWidth:containerWidth,containerLeft:containerLeft,containerRight:containerRight}=useDimension(),intervalXRef=useRef(null),intervalYRef=useRef(null),[autoscrollXOffset,setAutoscrollXOffset]=useState(),[autoscrollYOffset,setAutoscrollYOffset]=useState(),scrollYHeight=useMemo((()=>scrollYMeasureRef.current.height),[]),autoscrollXProps=useMemo((()=>({min:timelineLeftWidth+Math.min(10*containerUnit,50),max:timelineLeftWidth+Math.max(90*containerUnit,containerWidth-50)})),[timelineLeftWidth,containerUnit,containerWidth]),animatedStyle=useAnimatedStyle((()=>({opacity:opacity$.value})),[]);return useAnimatedReaction((()=>x$.value),(x=>{x<=autoscrollXProps.min?runOnJS(setAutoscrollXOffset)(-1):x>=autoscrollXProps.max?runOnJS(setAutoscrollXOffset)(1):runOnJS(setAutoscrollXOffset)(void 0)}),[autoscrollXProps]),useAnimatedReaction((()=>y$.value),(y=>{const scrollYUnit=scrollYHeight/100,adjustedY=y-offsetTop;adjustedY<=Math.min(5*scrollYUnit,50)?runOnJS(setAutoscrollYOffset)(-1):adjustedY>=Math.max(95*scrollYUnit,scrollYHeight-50)?runOnJS(setAutoscrollYOffset)(1):runOnJS(setAutoscrollYOffset)(void 0)}),[offsetTop]),useEffect((()=>(intervalYRef.current&&clearInterval(intervalYRef.current),autoscrollYOffset&&(intervalYRef.current=setInterval((()=>{released$.value?intervalYRef.current&&clearInterval(intervalYRef.current):scrollYTo({value:scrollY$.value+autoscrollYOffset*autoscrollYDistance,animated:!1})}),autoscrollYInterval)),()=>{intervalYRef.current&&clearInterval(intervalYRef.current)})),[scrollYTo,autoscrollYOffset]),useEffect((()=>(intervalXRef.current&&clearInterval(intervalXRef.current),autoscrollXOffset&&(intervalXRef.current=setInterval((()=>{released$.value?intervalXRef.current&&clearInterval(intervalXRef.current):moveContainers(autoscrollXOffset)}),autoscrollXInterval)),()=>{intervalXRef.current&&clearInterval(intervalXRef.current)})),[moveContainers,autoscrollXOffset]),jsx(View,{style:[styles$5.wrapper,{paddingLeft:containerLeft,paddingRight:containerRight}],children:jsx(AnimatedPressable,{style:[animatedStyle,styles$5.container],onPress:onPress,children:children})})},styles$5=StyleSheet.create({wrapper:{position:"absolute",width:"100%",height:"100%",zIndex:1},container:{flex:1,overflow:"hidden",cursor:"auto"}}),DragZone=({contentHeight$:contentHeight$,event:event,offsetTop:offsetTop,EventContent:EventContent,StickyEventContent:StickyEventContent})=>{const{timeWeight:timeWeight,timeStep:timeStep,timezone:timezone,timeDistance:timeDistance}=useDatetime(),{columnUnit:columnUnit,columnWidth:columnWidth,gridVerticalPadding:gridVerticalPadding,timelineLeftWidth:timelineLeftWidth,containerWidth:containerWidth,containerUnit:containerUnit}=useDimension(),{scrollY$:scrollY$}=useScroll(),{getActiveContainersDates:getActiveContainersDates}=useContainer(),{setDraggableEvent:setDraggableEvent}=useEvent(),{panning$:panning$,panX$:panX$,panY$:panY$}=usePan(),{onEventUpdated:onEventUpdated,onEventCreated:onEventCreated}=useAction(),{formatDate:formatDate}=useDatetime(),{getYByDate:getYByDate}=useOperation(),pinch=usePinch(),haptic=useHaptic(),sensitiveDataRef=useRef({containerWidth:containerWidth,timeWeight:timeWeight,gridVerticalPadding:gridVerticalPadding,timelineLeftWidth:timelineLeftWidth}),startEventYRef=useRef(getYByDate(event.uiStart).px),[schedule,setSchedule]=useState({start:event.uiStart,end:addMinutes(event.uiStart,event.duration)}),opacity$=useSharedValue(0),x$=useSharedValue(0),y$=useSharedValue(0),oX$=useSharedValue(0),oY$=useSharedValue(0),soY$=useSharedValue(event.origin||isWeb?0:Math.min(Math.floor(event.duration/2),60,timeDistance)),oTime$=useSharedValue(0),released$=useSharedValue(!1),startEventY$=useSharedValue(startEventYRef.current),dragEvent=useMemo((()=>{var _a;return Object.assign(Object.assign(Object.assign({},event),schedule),{text:(null===(_a=event.origin)||void 0===_a?void 0:_a.text)||`${formatDate(schedule.start,"p")} - ${formatDate(schedule.end,"p")}`})}),[event,formatDate,schedule]),eventDimensions=useMemo((()=>({width:containerUnit*columnWidth,height:contentHeight$.value/100*(timeWeight*event.duration)})),[]),scale$=useDerivedValue((()=>{var _a;return(null===(_a=null==pinch?void 0:pinch.scale$)||void 0===_a?void 0:_a.value)||1}),[]),eventX$=useDerivedValue((()=>x$.value+oX$.value),[]),eventY$=useDerivedValue((()=>y$.value+oY$.value+gridVerticalPadding),[gridVerticalPadding]),columnIndex$=useDerivedValue((()=>Math.floor(((released$.value?x$.value:panX$.value)-timelineLeftWidth)/containerWidth/columnUnit)),[]),stickyX$=useDerivedValue((()=>columnUnit*columnIndex$.value*containerWidth),[]),stickyY$=useDerivedValue((()=>startEventYRef.current-oTime$.value*scale$.value-scrollY$.value+gridVerticalPadding),[gridVerticalPadding]),enableDrag=useCallback((()=>released$.value=!1),[]),unmount=useCallback((()=>setDraggableEvent(void 0)),[]),updateSchedule=useCallback((()=>setSchedule({start:addMinutes(event.uiStart,-oTime$.value),end:addMinutes(event.uiStart,event.duration-oTime$.value)})),[]),releaseEvent=useCallback((()=>__awaiter(void 0,0,void 0,(function*(){var _a;yield Promise.all([new Promise((resolve=>{oX$.value=withTiming(stickyX$.value-x$.value,{duration:100},(()=>{runOnJS(resolve)()}))})),new Promise((resolve=>{oY$.value=withTiming(stickyY$.value-gridVerticalPadding-y$.value,{duration:100},(()=>{runOnJS(resolve)()}))}))]);try{let canUnmount=!0;const targetDate=getActiveContainersDates()[columnIndex$.value];if(targetDate){let eventParams;if(event.isAllDay)eventParams={start:startOfDay(targetDate.date),end:addMinutes(targetDate.date,event.duration)};else{const start=fromTzDate(set(targetDate.date,{hours:event.uiStart.getHours(),minutes:event.uiStart.getMinutes(),seconds:0,milliseconds:0}),(null===(_a=event.origin)||void 0===_a?void 0:_a.timezone)||timezone),newStart=addMinutes(start,-oTime$.value);eventParams=Object.assign({start:newStart,end:addMinutes(newStart,event.duration)},targetDate.collectionId&&{collectionId:targetDate.collectionId})}event.origin&&onEventUpdated?(!isEqual(event.start,eventParams.start)||targetDate.collectionId&&event.collectionId!==targetDate.collectionId)&&(canUnmount=yield onEventUpdated({event:Object.assign(Object.assign({},event.origin),eventParams)})):!event.origin&&onEventCreated&&(canUnmount=yield onEventCreated({event:eventParams}))}canUnmount&&setTimeout((()=>unmount()))}catch(_b){setTimeout((()=>unmount()))}}))),[getActiveContainersDates,onEventUpdated,onEventCreated,unmount,timezone,gridVerticalPadding]);return useAnimatedStyle((()=>({opacity:opacity$.value})),[]),useAnimatedReaction((()=>released$.value),((curr,prev)=>{curr!==prev&&(released$.value?(runOnJS(releaseEvent)(),soY$.value=0,startEventY$.value=stickyY$.value+scrollY$.value-gridVerticalPadding):(x$.value=panX$.value,y$.value=panY$.value,oX$.value=stickyX$.value-panX$.value,oY$.value=startEventY$.value-scrollY$.value-panY$.value-soY$.value))}),[releaseEvent,gridVerticalPadding]),useAnimatedReaction((()=>oTime$),(()=>!released$.value&&!event.isAllDay&&runOnJS(updateSchedule)()),[updateSchedule]),useAnimatedReaction((()=>panY$.value),(y=>!released$.value&&(y$.value=y)),[]),useAnimatedReaction((()=>scale$.value),((curr,prev)=>prev&&curr&&prev!==curr&&runOnJS(unmount)()),[]),useAnimatedReaction((()=>panX$.value),(x=>!released$.value&&(x$.value=x)),[]),useAnimatedReaction((()=>[y$.value,oY$.value,scrollY$.value]),(()=>{const diffPx=startEventYRef.current-(y$.value+oY$.value+scrollY$.value);oTime$.value=Math.round(diffPx/scale$.value/timeStep)*timeStep}),[timeStep]),useAnimatedReaction((()=>panning$.value),(panning=>!panning&&!released$.value&&(released$.value=!0)),[]),useAnimatedReaction((()=>[stickyX$.value,stickyY$.value]),(()=>!released$.value&&(null==haptic?void 0:haptic.emitImpact)&&runOnJS(haptic.emitImpact)("onDragEvent")),[null==haptic?void 0:haptic.emitImpact]),useEffect((()=>{const sensitiveData=sensitiveDataRef.current;containerWidth===sensitiveData.containerWidth&&timeWeight===sensitiveData.timeWeight&&gridVerticalPadding===sensitiveData.gridVerticalPadding&&timelineLeftWidth===sensitiveData.timelineLeftWidth||unmount()}),[unmount,gridVerticalPadding,timeWeight,containerWidth,timelineLeftWidth]),useLayoutEffect((()=>{opacity$.value=withTiming(1,{duration:200})}),[]),jsxs(DragZoneController,{x$:x$,y$:y$,opacity$:opacity$,released$:released$,offsetTop:offsetTop,onPress:unmount,children:[jsx(DragDropColumn,{x$:stickyX$}),jsx(DragEvent,{event:dragEvent,width:eventDimensions.width,height:eventDimensions.height,x$:eventX$,y$:eventY$,onPressIn:enableDrag,EventContent:EventContent}),!!StickyEventContent&&jsx(DragStickyEvent,{event:dragEvent,width:eventDimensions.width,height:eventDimensions.height,y$:stickyY$,x$:stickyX$,onPressIn:enableDrag,EventContent:StickyEventContent})]})};memo((props=>props.active&&jsx(AnimatedProgressBar,Object.assign({},props))));const AnimatedProgressBar=memo((({reversed:reversed,type:type,rtl:rtl,color:color,top:top})=>{const width$=useSharedValue(0),opposite=rtl&&!reversed||!rtl&&reversed,animatedStyle=useAnimatedStyle((()=>({alignSelf:opposite?"flex-end":"flex-start",backgroundColor:interpolateColor(width$.value,[0,25,50,75,100],color),width:`${"determinate"===type?width$.value:interpolate(width$.value,[0,100],[20,100])}%`,[opposite?"left":"right"]:void 0,[opposite?"right":"left"]:`${"determinate"===type?0:interpolate(width$.value,[0,100],[-20,100])}%`})),[type]);return useEffect((()=>{width$.value=withRepeat(withTiming(100,{duration:1500}),-1)}),[]),jsx(Animated.View,{style:[styles$4.container,{top:top}],entering:FadeIn,exiting:FadeOut,children:jsx(Animated.View,{style:[styles$4.progress,animatedStyle]})})})),styles$4=StyleSheet.create({container:{position:"absolute",left:0,zIndex:1,height:2,width:"100%",pointerEvents:"none"},progress:{position:"absolute",height:2}}),HorizontalLinesView=memo((({contentHeight$:contentHeight$,timeSlots:timeSlots,backgroundColor:backgroundColor,size:size,left:left,right:right,Line:Line,render:render})=>{const animatedStyle=useAnimatedStyle((()=>({top:-Math.floor(size/2),height:contentHeight$.value+size})),[size]);return jsx(Animated.View,{style:[styles$3.view,animatedStyle,{left:left,right:right}],children:timeSlots.map(((time,index)=>jsx(Line,{time:time,index:index,backgroundColor:backgroundColor,height:size,timeSlots:timeSlots,render:render},time)))})})),HorizontalLine=memo((({index:index,backgroundColor:backgroundColor,height:height,timeSlots:timeSlots})=>jsx(View,{style:{backgroundColor:backgroundColor,height:height,opacity:0===index||index===timeSlots.length-1?0:void 0}})));memo((props=>{var _a;return(null===(_a=props.render)||void 0===_a?void 0:_a.call(props,{time:props.time}))||jsx(HorizontalLine,Object.assign({},props))}));const styles$3=StyleSheet.create({view:{flex:1,top:0,position:"absolute",pointerEvents:"none",width:"100%",height:"100%",justifyContent:"space-between"}}),ScrollYController=({selectedDate:selectedDate,children:children,contentStyle:contentStyle,refreshable:refreshable,refreshing:refreshing,simultaneousHandlers:simultaneousHandlers,onRefresh:onRefresh,onLoad:onLoad})=>{const{scrollY$:scrollY$,scrollableY:scrollableY,scrollYRef:scrollYRef,scrollYMeasureRef:scrollYMeasureRef}=useScroll(),{rendered:rendered}=useRendered(),{timezone:timezone}=useDatetime(),{draggableEvent:draggableEvent}=useEvent(),{gridVerticalPadding:gridVerticalPadding}=useDimension(),{rtl:rtl}=useController(),{getYByDate:getYByDate}=useOperation(),{getDatetimeFromPressEvent:getDatetimeFromPressEvent,onDatePress:onDatePress}=useOperation(),{onDatetimePress:onDatetimePress,onDatetimeLongPress:onDatetimeLongPress,onDatetimeContextMenu:onDatetimeContextMenu}=useAction(),isInitiallyScrolled=useRef(!1),onPress=useCallback((e=>onDatePress(e,"onDatetimePress",onDatetimePress)),[onDatePress,onDatetimePress]),onLongPress=useCallback((e=>onDatePress(e,"onDatetimeLongPress",onDatetimeLongPress)),[onDatePress,onDatetimeLongPress]),onContextMenu=useCallback((e=>{e.preventDefault(),null==onDatetimeContextMenu||onDatetimeContextMenu(Object.assign(Object.assign({},getDatetimeFromPressEvent(e)),{x:e.nativeEvent.pageX,y:e.nativeEvent.pageY}))}),[getDatetimeFromPressEvent,onDatetimeContextMenu]),onScrollY=useCallback((event=>{scrollY$.value=event.nativeEvent.contentOffset.y}),[]),onScrollYLayout=useCallback((e=>{(isWeb&&e.nativeEvent.target||e.target).measureInWindow(((x,y,width,height)=>{var _a;scrollYMeasureRef.current={x:x,y:y,width:width,height:height},isInitiallyScrolled.current||(isInitiallyScrolled.current=!0,null===(_a=scrollYRef.current)||void 0===_a||_a.scrollTo({y:getYByDate(tzDate(selectedDate,timezone)).px-height/2,animated:!1}))}))}),[]);return useEffect((()=>{rendered&&(null==onLoad||onLoad())}),[rendered]),jsx(ScrollView,{pinchGestureEnabled:!1,bouncesZoom:!1,showsVerticalScrollIndicator:!1,scrollEventThrottle:16,ref:scrollYRef,simultaneousHandlers:simultaneousHandlers,scrollEnabled:scrollableY&&!draggableEvent,contentContainerStyle:{paddingVertical:gridVerticalPadding},refreshControl:refreshable?jsx(RefreshControl,{refreshing:!!refreshing,onRefresh:onRefresh}):void 0,onLayout:onScrollYLayout,onScroll:onScrollY,children:jsx(AnimatedPressable,{style:[contentStyle,{flexDirection:rtl?"row-reverse":"row",cursor:onDatetimePress||onDatetimeLongPress?"pointer":"auto"}],onPress:onPress,onLongPress:onLongPress,onContextMenu:onContextMenu,children:rendered&&children})})},fromDate=startOfDay(new Date),TimelineView=props=>{const{timelineBackgroundColor:timelineBackgroundColor,timelineTextColor:timelineTextColor}=useTheme(),{timeSlots:timeSlots,timelineTextFormat:timelineTextFormat,formatDate:formatDate}=useDatetime(),{rendered:rendered}=useRendered(),{timelineWidth:timelineWidth}=useDimension();return rendered&&jsx(Timeline,Object.assign({},props,{width:timelineWidth,backgroundColor:timelineBackgroundColor,color:timelineTextColor,format:timelineTextFormat,timeSlots:timeSlots,formatDate:formatDate}))},Timeline=memo((({width:width,Time:Time,render:render,backgroundColor:backgroundColor,color:color,format:format,timeSlots:timeSlots,formatDate:formatDate})=>jsx(View,{style:[styles$2.timeline,{width:width,backgroundColor:backgroundColor}],children:timeSlots.map(((time,index)=>index<timeSlots.length-1&&jsx(View,{style:styles$2.timeSlot,children:jsx(Time,{time:time,index:index,color:color,format:format,formatDate:formatDate,render:render})},time)))}))),TimeText=memo((({time:time,index:index,color:color,format:format,formatDate:formatDate})=>0!==index&&jsx(Text,{style:[styles$2.text,{color:color}],children:formatDate(addMinutes(fromDate,time),format)})));memo((props=>{var _a;return(null===(_a=props.render)||void 0===_a?void 0:_a.call(props,{time:props.time}))||jsx(TimeText,Object.assign({},props))}));const styles$2=StyleSheet.create({timeline:{height:"100%",zIndex:2},timeSlot:{flex:1,width:"100%"},text:{textAlign:"center",fontSize:10,lineHeight:10,top:-5}}),HeaderSafeArea=memo((({backgroundColor:backgroundColor,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,height:height,onPress:onPress,emitImpact:emitImpact,SafeArea:SafeArea})=>{const press=useCallback((()=>{null==onPress||onPress(),null==emitImpact||emitImpact("onHeaderSafeAreaPress")}),[emitImpact,onPress]);return jsx(Pressable,{disabled:!onPress,style:[styles$1.view,{height:height,backgroundColor:backgroundColor,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth}],onPress:press,children:!!SafeArea&&jsx(SafeArea,{})})})),styles$1=StyleSheet.create({view:{width:"100%",overflow:"hidden"}}),TimelineColumnView=props=>{const haptic=useHaptic(),{allDayEventsSafeAreaText:allDayEventsSafeAreaText}=useEvent(),{onHeaderSafeAreaPress:onHeaderSafeAreaPress,onAllDayEventsSafeAreaPress:onAllDayEventsSafeAreaPress}=useAction(),{timelineBackgroundColor:timelineBackgroundColor,verticalLineColor:verticalLineColor,horizontalLineColor:horizontalLineColor,headerSafeAreaBackgroundColor:headerSafeAreaBackgroundColor,allDayEventsSafeAreaBackgroundColor:allDayEventsSafeAreaBackgroundColor,allDayEventsSafeAreaTextColor:allDayEventsSafeAreaTextColor}=useTheme(),{timelineWidth:timelineWidth,verticalLineSize:verticalLineSize,horizontalLineSize:horizontalLineSize,headerHeight:headerHeight}=useDimension(),{isDayHeaderVisible:isDayHeaderVisible,isCollectionHeaderVisible:isCollectionHeaderVisible,isAllDayEventsEnabled:isAllDayEventsEnabled,rtl:rtl}=useController();return jsx(TimelineColumn,Object.assign({},props,{rtl:rtl,showHeader:isDayHeaderVisible||isCollectionHeaderVisible,showEvents:isAllDayEventsEnabled,width:timelineWidth+verticalLineSize,borderWidth:verticalLineSize,borderColor:verticalLineColor,backgroundColor:timelineBackgroundColor,borderBottomColor:horizontalLineColor,borderBottomWidth:horizontalLineSize,safeAreaBgColor:headerSafeAreaBackgroundColor,headerHeight:headerHeight,adeBgColor:allDayEventsSafeAreaBackgroundColor,adeColor:allDayEventsSafeAreaTextColor,adeText:allDayEventsSafeAreaText||"All-day",emitImpact:null==haptic?void 0:haptic.emitImpact,onHeaderPress:onHeaderSafeAreaPress,onEventsPress:onAllDayEventsSafeAreaPress}))},TimelineColumn=memo((({rtl:rtl,showHeader:showHeader,showEvents:showEvents,width:width,backgroundColor:backgroundColor,borderWidth:borderWidth,borderColor:borderColor,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,adeBgColor:adeBgColor,adeColor:adeColor,adeText:adeText,safeAreaBgColor:safeAreaBgColor,headerHeight:headerHeight,allDayEventsHeight:allDayEventsHeight,onHeaderPress:onHeaderPress,onEventsPress:onEventsPress,emitImpact:emitImpact,EventsSafeArea:EventsSafeArea,SafeArea:SafeArea,renderEvents:renderEvents})=>jsxs(View,{style:[styles$k.view,Object.assign({width:width,backgroundColor:backgroundColor},rtl?{borderLeftWidth:borderWidth,borderLeftColor:borderColor,right:0}:{borderRightWidth:borderWidth,borderRightColor:borderColor,left:0})],children:[showHeader&&jsx(HeaderSafeArea,{SafeArea:SafeArea,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,backgroundColor:safeAreaBgColor,height:headerHeight,onPress:onHeaderPress,emitImpact:emitImpact}),showEvents&&jsx(AllDayEventsSafeArea,{SafeArea:EventsSafeArea,emitImpact:emitImpact,text:adeText,color:adeColor,backgroundColor:adeBgColor,borderBottomColor:borderBottomColor,borderBottomWidth:borderBottomWidth,height:allDayEventsHeight,onPress:onEventsPress,render:renderEvents})]}))),styles$k=StyleSheet.create({view:{zIndex:2,position:"absolute",top:0,bottom:0}}),TimeGrid=forwardRef(((props,ref)=>{const{onChangeDate:onChangeDate}=props,selectedDateRef=useRef(props.startDate||new Date),onChangeDebounced=((callback,delay)=>{const timeoutRef=useRef(null),lastArgsRef=useRef(null),debouncedCallback=useCallback((arg=>{lastArgsRef.current=arg,timeoutRef.current&&clearTimeout(timeoutRef.current),timeoutRef.current=setTimeout((()=>{null!==lastArgsRef.current&&callback(lastArgsRef.current)}),delay)}),[callback,delay]);return useEffect((()=>()=>{timeoutRef.current&&clearTimeout(timeoutRef.current)}),[]),debouncedCallback})((date=>null==onChangeDate?void 0:onChangeDate(date)),props.debounceable?500:0),changeDate=useCallback((date=>{const adjustedDate=startOfDay(date);selectedDateRef.current=adjustedDate,onChangeDebounced(adjustedDate)}),[onChangeDebounced]);return jsx(ThemeProvider,{theme:props.theme,children:jsx(DatetimeProvider,{timezone:props.timezone,weekStartsOn:props.weekStartsOn,hiddenDays:props.hiddenDays,minDate:props.minDate,maxDate:props.maxDate,numberOfDays:props.numberOfDays,timeFrom:props.timeFrom,timeTo:props.timeTo,timeInterval:props.timeInterval,timeStep:props.timeStep,locale:props.locale,dayHeaderTextFormat:props.dayHeaderTextFormat,timelineTextFormat:props.timelineTextFormat,children:jsx(ControllerProvider,{snappable:props.snappable,draggable:props.draggable,rtl:props.rtl,isTimelineVisible:props.isTimelineVisible,isNowIndicatorVisible:props.isNowIndicatorVisible,isAllDayEventsEnabled:props.isAllDayEventsEnabled,isAllDayEventsVisible:props.isAllDayEventsVisible,isDayHeaderVisible:props.isDayHeaderVisible,children:jsx(DimensionProvider,{width:props.width,horizontalLineSize:props.horizontalLineSize,gridVerticalPadding:props.gridVerticalPadding,allDayEventHeight:props.allDayEventHeight,dayHeaderHeight:props.dayHeaderHeight,timelineWidth:props.timelineWidth,nowIndicatorHeight:props.nowIndicatorHeight,eventBorderWidth:props.eventBorderWidth,eventBorderRadius:props.eventBorderRadius,children:jsx(ScrollProvider,{children:jsx(ContainerProvider,{selectedDateRef:selectedDateRef,setSelectedDate:changeDate,children:jsx(UtProvider,{unavailableTime:props.unavailableTime,children:jsx(EventProvider,{createEventDuration:props.createEventDuration,events:props.events,allDayEventsSafeAreaText:props.allDayEventsSafeAreaText,children:jsx(PanProvider,{swipeable:props.swipeable,children:jsx(OperationProvider,{selectedDateRef:selectedDateRef,setSelectedDate:changeDate,children:jsx(ActionProvider,{onHeaderSafeAreaPress:props.onHeaderSafeAreaPress,onAllDayEventsSafeAreaPress:props.onAllDayEventsSafeAreaPress,onDayHeaderPress:props.onDayHeaderPress,onLoad:props.onLoad,onUnavailableTimePress:props.onUnavailableTimePress,onUnavailableTimeLongPress:props.onUnavailableTimeLongPress,onDatetimeContextMenu:props.onDatetimeContextMenu,onDatetimePress:props.onDatetimePress,onDatetimeLongPress:props.onDatetimeLongPress,onEventPress:props.onEventPress,onEventLongPress:props.onEventLongPress,onEventUpdated:props.onEventUpdated,onEventCreated:props.onEventCreated,children:jsx(Body,{selectedDateRef:selectedDateRef,timegridRef:ref})})})})})})})})})})})})})),Body=({selectedDateRef:selectedDateRef,timegridRef:timegridRef})=>{const{horizontalLineColor:horizontalLineColor}=useTheme(),{activeContainers:activeContainers}=useContainer(),{panGesture:panGesture,panGestureRef:panGestureRef}=usePan(),{timeSlots:timeSlots,timeInterval:timeInterval}=useDatetime(),{isTimelineVisible:isTimelineVisible,isAllDayEventsEnabled:isAllDayEventsEnabled}=useController(),{draggableEvent:draggableEvent,maxAllDayEventsByOffset:maxAllDayEventsByOffset}=useEvent(),{headerHeight:headerHeight,allDayEventHeight:allDayEventHeight,hlLeft:hlLeft,hlRight:hlRight,horizontalLineSize:horizontalLineSize}=useDimension(),contentOpacity$=useSharedValue(1),contentHeight$=useDerivedValue((()=>(timeSlots.length-1)*timeInterval),[timeSlots,timeInterval]),{onLoad:onLoad}=useAction(),allDayEventsHeight=useMemo((()=>isAllDayEventsEnabled?maxAllDayEventsByOffset*allDayEventHeight+2+horizontalLineSize:horizontalLineSize),[allDayEventHeight,horizontalLineSize,isAllDayEventsEnabled,maxAllDayEventsByOffset]),paddingTop=useMemo((()=>headerHeight+allDayEventsHeight),[headerHeight,allDayEventsHeight]),contentStyle=useAnimatedStyle((()=>({height:contentHeight$.value,opacity:contentOpacity$.value})),[]);return jsxs(BodyController,{contentOpacity$:contentOpacity$,selectedDateRef:selectedDateRef,gesture:panGesture,paddingTop:paddingTop,timegridRef:timegridRef,children:[activeContainers.map((container=>jsx(Columns,{container:container,allDayEventsHeight:allDayEventsHeight},container.offset))),isTimelineVisible&&jsx(TimelineColumnView,{allDayEventsHeight:allDayEventsHeight,EventsSafeArea:EventsSafeAreaContent}),jsxs(View,{style:styles.container,children:[jsxs(ScrollYController,{selectedDate:selectedDateRef.current,contentStyle:contentStyle,simultaneousHandlers:[panGestureRef],onLoad:onLoad,children:[isTimelineVisible&&jsx(TimelineView,{Time:TimeText}),jsx(HorizontalLinesView,{contentHeight$:contentHeight$,timeSlots:timeSlots,backgroundColor:horizontalLineColor,size:horizontalLineSize,left:hlLeft,right:hlRight,Line:HorizontalLine}),activeContainers.map((container=>jsx(ContentElements,{container:container},container.offset)))]}),!!draggableEvent&&jsx(DragZone,{contentHeight$:contentHeight$,event:draggableEvent,offsetTop:paddingTop,EventContent:EventDragContent})]})]})},styles=StyleSheet.create({container:{overflow:"hidden",zIndex:3,flex:1}});export{TimeGrid};
